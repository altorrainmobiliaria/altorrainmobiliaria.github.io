<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Detalle de propiedad | Altorra</title>
  <meta name="description" content="Detalles de propiedad de Altorra Inmobiliaria" />
  <!-- PWA and social metadata -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#d4af37" />
  <meta property="og:title" content="Detalles de propiedad | Altorra" />
  <meta property="og:description" content="Descubre los detalles de esta propiedad disponible para comprar, arrendar o rentar por d√≠as." />
  <meta property="og:image" content="/img/uploads/comprar1.png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700;800&display=swap" rel="stylesheet" />
  <style>
    :root{
      --gold:#d4af37;
      --accent:#ffb400;
      --bg:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --header-h:72px;
      --page-max:1200px;
      --overlay: rgba(0,0,0,0.30);
    }

    *{box-sizing:border-box;margin:0;padding:0;font-family:"Poppins",system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:var(--text);background:transparent;}
    html,body{background:var(--bg);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
    a{text-decoration:none;color:inherit;}

    /* ====== SAFE AREAS / LAYOUT ====== */
    main.detail-container{
      max-width:var(--page-max);
      margin:calc(var(--header-h) + 20px) auto 40px;
      padding:0 16px 40px;          /* padding-bottom asegura respiro antes del footer */
      display:flex; flex-wrap:wrap; gap:24px;
      overflow:clip;                /* evita desbordes horizontales por la galer√≠a */
    }
    [id]{ scroll-margin-top: calc(var(--header-h) + 12px); } /* anclas seguras bajo header fijo */

    /* ====== GALLERY ====== */
    .gallery{flex:1 1 520px; position:relative; overflow:visible;}
    .gallery-inner{ position:relative; }
    .main-img{
      width:100%;
      border-radius:14px;
      margin-bottom:10px;
      aspect-ratio: 16/9;           /* relaci√≥n agradable, evita saltos de layout */
      object-fit:cover;             /* llena el cuadro sin deformar */
      background:#f5f5f7;
      display:block;
      transition:transform .28s ease, box-shadow .28s ease;
      cursor:zoom-in;
      box-shadow:0 10px 26px rgba(0,0,0,.06);
    }
    .main-img:hover{ transform:scale(1.02); box-shadow:0 16px 36px rgba(0,0,0,.12); }

    .gallery .arrow{
      position:absolute; top:50%; transform:translateY(-50%);
      width:40px; height:40px; border-radius:999px; border:none;
      background:#fff; color:#111; cursor:pointer; z-index:3;
      display:flex; align-items:center; justify-content:center;
      box-shadow:0 10px 26px rgba(0,0,0,.12);
      transition:transform .15s ease, box-shadow .2s ease, opacity .2s ease;
    }
    .gallery .arrow:hover{ transform:translateY(-50%) scale(1.05); box-shadow:0 14px 30px rgba(0,0,0,.16); }
    .gallery .arrow.prev{ left:10px; }
    .gallery .arrow.next{ right:10px; }

    .thumbnails{
      display:flex; gap:10px; overflow-x:auto; padding-bottom:2px;
      scroll-snap-type:x proximity;
    }
    .thumbnails::-webkit-scrollbar{ height:8px }
    .thumbnails::-webkit-scrollbar-thumb{ background:rgba(0,0,0,.12); border-radius:999px }

    .thumbnails img{
      width:96px; height:70px; object-fit:cover; border-radius:10px; flex-shrink:0;
      cursor:pointer; opacity:.7; border:2px solid transparent; background:#f3f4f6;
      scroll-snap-align:start; transition:opacity .15s ease, border-color .15s ease, transform .15s ease;
    }
    .thumbnails img:hover{ opacity:.95; transform:translateY(-1px); }
    .thumbnails img.active{ opacity:1; border-color:var(--gold); }

    /* ====== INFO CARD ====== */
    .info{flex:1 1 380px; border:1px solid rgba(17,24,39,.08); border-radius:16px; padding:18px 18px 22px; box-shadow:0 12px 32px rgba(17,24,39,.06); position:relative}
    .info h1{ margin:0 0 8px; font-size:1.6rem; font-weight:800; color:var(--gold); }
    .specs{ display:grid; gap:10px; grid-template-columns:repeat(2,minmax(0,1fr)); }
    .specs .item{ display:flex; align-items:center; gap:6px; color:#374151; font-weight:600; }
    .price-row{ display:flex; align-items:center; gap:12px; margin:10px 0 12px; }
    .price{ font-size:1.4rem; font-weight:800; color:#111827; }
    .badge{ display:inline-flex; align-items:center; gap:6px; background:#f5f5f5; border:1px solid rgba(17,24,39,.06); color:#111827; padding:6px 10px; border-radius:999px; font-size:.88rem; font-weight:700 }
    .desc{ color:#374151; line-height:1.5; }
    .actions{ display:flex; gap:10px; margin-top:6px }
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 14px; border-radius:999px; border:1px solid rgba(17,24,39,.06); background:#111827; color:#fff; font-weight:700; cursor:pointer; text-align:center; text-decoration:none }
    .btn-secondary{ background:#fff; color:#111827 }

    /* ====== HEADER (id√©ntico) ====== */
    header{ position:fixed; top:0; left:0; right:0; height:var(--header-h); backdrop-filter:saturate(160%) blur(8px); background:rgba(255,255,255,.82); border-bottom:1px solid rgba(17,24,39,.06); z-index:100 }
    .nav{ max-width:var(--page-max); margin:0 auto; height:100%; display:flex; align-items:center; justify-content:space-between; padding:0 16px }
    .brand{ font-weight:800; letter-spacing:.4px; color:#111 }
    .nav-links{ display:flex; align-items:center; gap:18px }
    .nav-item{ position:relative }
    .nav-btn{ font-weight:700; padding:6px 10px; border-radius:8px; border:0; cursor:pointer; background:transparent }
    .nav-btn:hover{ background:rgba(17,24,39,.06) }
    .nav-toggle{ display:none }
    @media (max-width:860px){
      nav .nav-links{ display:none }
      .nav-toggle{ display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:8px 12px; border-radius:12px; border:1px solid rgba(17,24,39,.08) }
    }
    .menu-panel{ position:fixed; top:var(--header-h); display:none; background:#fff; border:1px solid rgba(17,24,39,.08); border-radius:16px; box-shadow:0 24px 64px rgba(17,24,39,.16); padding:12px; z-index:99; }
    .menu-panel.menu-visible{ display:block }
    .panel-compact{ width:auto; max-width:520px }
    .panel-mega{ width:auto; max-width:920px }
    .menu-link{ display:block; padding:10px 12px; border-radius:10px; color:#111827 }
    .menu-link:hover{ background:#f5f5f5 }

    /* ====== DRAWER M√ìVIL ====== */
    .drawer-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.36); opacity:0; pointer-events:none; transition:opacity .2s ease; z-index:98 }
    .drawer-backdrop.open{ opacity:1; pointer-events:auto }
    .drawer{ position:fixed; left:0; right:0; top:var(--header-h); bottom:0; background:#0b0b0b; color:#fff; transform:translateY(12px); opacity:.0; pointer-events:none; transition:transform .2s ease, opacity .2s ease; z-index:99; overflow:auto }
    .drawer.open{ transform:translateY(0); opacity:1; pointer-events:auto }
    .drawer .block{ padding:16px; border-bottom:1px solid rgba(255,255,255,.08) }
    .drawer a{ color:#cbd5e1; display:block; padding:10px 0 }

    /* ====== FOOTER ====== */
    footer{background:#0b0b0b;color:#fff;padding:36px 16px}
    .footer-grid{max-width:var(--page-max);margin:0 auto;display:grid;grid-template-columns:repeat(4,1fr);gap:18px}
    .footer-grid h4{margin:0 0 8px;font-weight:700;color:var(--gold)}
    .footer-grid a{color:#cbd5e1}
    @media (max-width:920px){ .footer-grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
<a href="#propertyDetail" class="sr-only">Saltar al contenido principal</a>

<header>
  <div class="nav">
    <div class="brand">ALTORRA</div>
    <nav>
      <div class="nav-links">
        <div class="nav-item" data-size="mega">
          <button class="nav-btn" data-panel="panel-propiedades" aria-expanded="false">Propiedades</button>
        </div>
        <div class="nav-item" data-size="mega">
          <button class="nav-btn" data-panel="panel-servicios" aria-expanded="false">Servicios</button>
        </div>
        <div class="nav-item">
          <button class="nav-btn" data-panel="panel-nosotros" aria-expanded="false">Nosotros</button>
        </div>
        <div class="nav-item">
          <a class="nav-btn" href="contacto.html">Contacto</a>
        </div>
      </div>
    </nav>
    <button id="navToggle" class="nav-toggle" aria-controls="mobileMenu" aria-expanded="false" aria-label="Abrir men√∫">‚ò∞ Men√∫</button>
  </div>
</header>

<!-- Paneles del header (sin tocar) -->
<div id="panel-propiedades" class="menu-panel panel-compact" role="dialog" aria-modal="false" aria-hidden="true">
  <a class="menu-link" href="propiedades-comprar.html">Comprar</a>
  <a class="menu-link" href="propiedades-arrendar.html">Arrendar</a>
  <a class="menu-link" href="propiedades-alojamientos.html">Rentar por d√≠as</a>
</div>
<div id="panel-servicios" class="menu-panel panel-mega" role="dialog" aria-modal="false" aria-hidden="true">
  <div class="mega-grid">
    <div class="mega-col">
      <h4>Gesti√≥n</h4>
      <a class="menu-link" href="servicios-administracion.html">Administraci√≥n de inmuebles</a>
      <a class="menu-link" href="servicios-avaluos.html">Aval√∫os</a>
      <a class="menu-link" href="servicios-mantenimiento.html">Mantenimiento y reparaciones</a>
      <a class="menu-link" href="servicios-mudanzas.html">Mudanzas y log√≠stica</a>
    </div>
    <div class="mega-col">
      <h4>Jur√≠dico &amp; Contable</h4>
      <a class="menu-link" href="servicios-juridicos.html">Servicios jur√≠dicos</a>
      <a class="menu-link" href="servicios-contables.html">Servicios contables</a>
      <a class="menu-link" href="#">Gesti√≥n de contratos</a>
    </div>
    <div class="mega-col">
      <h4>Turismo (Cartagena)</h4>
      <a class="menu-link" href="#">Renta de yates</a>
      <a class="menu-link" href="#">Pasad√≠as en islas</a>
      <a class="menu-link" href="#">Paquetes tur√≠sticos</a>
      <a class="menu-link" href="#">Tours hist√≥ricos</a>
    </div>
  </div>
</div>
<div id="panel-nosotros" class="menu-panel panel-compact" role="dialog" aria-modal="false" aria-hidden="true">
  <a class="menu-link" href="quienes-somos.html">Qui√©nes somos</a>
  <a class="menu-link" href="quienes-somos.html#mision">Misi√≥n</a>
  <a class="menu-link" href="quienes-somos.html#vision">Visi√≥n</a>
  <a class="menu-link" href="quienes-somos.html#valores">Valores</a>
  <a class="menu-link" href="quienes-somos.html#equipo">Nuestro equipo</a>
</div>

<!-- Men√∫ m√≥vil (sin tocar) -->
<div id="drawerBackdrop" class="drawer-backdrop" aria-hidden="true"></div>
<aside id="mobileMenu" class="drawer" role="dialog" aria-modal="true" aria-labelledby="mobileMenuTitle" hidden>
  <div class="block">
    <h3 id="mobileMenuTitle" style="margin:0;font-weight:800;color:var(--gold)">Men√∫</h3>
  </div>
  <div class="block">
    <h4>Propiedades</h4>
    <a href="propiedades-comprar.html">Comprar</a>
    <a href="propiedades-arrendar.html">Arrendar</a>
    <a href="propiedades-alojamientos.html">Rentar por d√≠as</a>
  </div>
  <div class="block">
    <h4>Servicios</h4>
    <a href="servicios-administracion.html">Administraci√≥n de inmuebles</a>
    <a href="servicios-avaluos.html">Aval√∫os</a>
    <a href="servicios-mantenimiento.html">Mantenimiento y reparaciones</a>
    <a href="servicios-mudanzas.html">Mudanzas y log√≠stica</a>
    <a href="servicios-juridicos.html">Servicios jur√≠dicos</a>
    <a href="servicios-contables.html">Servicios contables</a>
    <a href="#">Gesti√≥n de contratos</a>
    <h4 style="margin-top:12px">Turismo (Cartagena)</h4>
    <a href="#">Renta de yates</a>
    <a href="#">Pasad√≠as en islas</a>
    <a href="#">Paquetes tur√≠sticos</a>
    <a href="#">Tours hist√≥ricos</a>
  </div>
  <div class="block">
    <h4>Empresa</h4>
    <a href="quienes-somos.html">Qui√©nes somos</a>
    <a href="contacto.html">Contacto</a>
    <a href="home.html">Inicio</a>
  </div>
</aside>

<main id="propertyDetail" class="detail-container">
  <!-- Rellenado din√°micamente -->
</main>

<!-- (FOOTER: sin tocar) -->
<footer>
  <div class="footer-grid">
    <div>
      <h3 style="margin:0;color:var(--gold);font-weight:800">ALTORRA INMOBILIARIA</h3>
      <p style="color:#cbd5e1;margin-top:8px;line-height:1.4">
        Administraci√≥n, Arriendo y Venta de Inmuebles<br/>
        Aval√∫os<br/>
        Servicios Legales Especializados
      </p>
      <div style="margin-top:12px;font-weight:800;color:var(--gold)">+57&nbsp;323&nbsp;501&nbsp;6747</div>
    </div>
    <div>
      <h4 style="margin:0 0 8px;font-weight:700;color:var(--gold)">Propiedades</h4>
      <ul style="margin:0;padding:0;list-style:none;color:#cbd5e1">
        <li><a href="propiedades-comprar.html" style="color:#cbd5e1">Comprar</a></li>
        <li><a href="propiedades-arrendar.html" style="color:#cbd5e1">Arrendar</a></li>
        <li><a href="propiedades-alojamientos.html" style="color:#cbd5e1">Por d√≠as</a></li>
      </ul>
    </div>
    <div>
      <h4 style="margin:0 0 8px;font-weight:700;color:var(--gold)">Servicios</h4>
      <ul style="margin:0;padding:0;list-style:none;color:#cbd5e1">
        <li><a href="servicios-administracion.html" style="color:#cbd5e1">Administraci√≥n</a></li>
        <li><a href="servicios-juridicos.html" style="color:#cbd5e1">Servicios jur√≠dicos</a></li>
        <li><a href="servicios-contables.html" style="color:#cbd5e1">Servicios contables</a></li>
      </ul>
    </div>
    <div>
      <h4 style="margin:0 0 8px;font-weight:700;color:var(--gold)">Empresa</h4>
      <ul style="margin:0;padding:0;list-style:none;color:#cbd5e1">
        <li><a href="quienes-somos.html" style="color:#cbd5e1">Qui√©nes somos</a></li>
        <li><a href="contacto.html" style="color:#cbd5e1">Contacto</a></li>
        <li><a href="home.html" style="color:#cbd5e1">Inicio</a></li>
      </ul>
    </div>
  </div>
  <div style="max-width:var(--page-max);margin:18px auto 0;color:#9ca3af;text-align:center;font-size:0.9rem">¬© 2025 Altorra Inmobiliaria ‚Äî Hecho con confianza.</div>
</footer>

<!-- Service worker -->
<script>
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('/service-worker.js').catch(function(err){ console.warn('SW registration failed', err); });
  }
</script>

<!-- Lazy loading im√°genes -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('img').forEach(function(img) {
      if (!img.hasAttribute('loading')) img.setAttribute('loading', 'lazy');
    });
  });
</script>

<!-- P√°gina: l√≥gica detalle -->
<script>
  function getParam(name){
    const params = new URLSearchParams(window.location.search);
    return params.get(name) || '';
  }
  function formatCOP(n){
    if(!n && n!==0) return '';
    return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,'.');
  }
  function escapeHtml(str){
    return String(str||'').replace(/[&<>"]/g,function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m];});
  }
  function buildWhatsAppLink(p){
    const phone = '573235016747';
    const company = 'Altorra Inmobiliaria';
    const price = p.price ? ('$'+formatCOP(p.price)+' COP') : '';
    let opLabel = '';
    if(p.operation === 'arrendar') opLabel = ' / mes';
    else if(p.operation === 'dias') opLabel = ' / noche';
    const text = `Hola ${company}, me interesa la propiedad "${p.title}" (ID: ${p.id}) en ${p.city} ${price}${opLabel}. ¬øPodemos agendar una visita?`;
    return 'https://wa.me/'+phone+'?text='+encodeURIComponent(text);
  }

  async function init(){
    const id = getParam('id');
    const container = document.getElementById('propertyDetail');
    if(!id){ container.innerHTML = '<p>Propiedad no especificada.</p>'; return; }

    try{
      const res = await fetch('properties/data.json', {cache:'no-store'});
      if(!res.ok) throw new Error('HTTP '+res.status);
      const data = await res.json();
      const prop = data.find(item => item.id === id);
      if(!prop){ container.innerHTML = '<p>Propiedad no encontrada.</p>'; return; }

      /* ========== GALLERY ========== */
      const galleryDiv = document.createElement('div');
      galleryDiv.className = 'gallery';
      const G = document.createElement('div');
      G.className = 'gallery-inner';

      const imgsRaw = Array.isArray(prop.images) && prop.images.length ? prop.images : ['https://i.postimg.cc/0yYb8Y6r/placeholder.png'];
      const imgs = imgsRaw.map(function(src){
        if(src.startsWith('http') || src.startsWith('//')) return src;
        return src.startsWith('/') ? src : '/' + src;
      });

      let currentIndex = 0;

      const mainImg = document.createElement('img');
      mainImg.className = 'main-img';
      mainImg.decoding = 'async';
      mainImg.src = imgs[0];
      mainImg.alt = escapeHtml(prop.title || 'Imagen de la propiedad');
      G.appendChild(mainImg);

      const prevBtn = document.createElement('button');
      prevBtn.className = 'arrow prev';
      prevBtn.setAttribute('aria-label','Imagen anterior');
      prevBtn.innerHTML = '&#8249;';
      const nextBtn = document.createElement('button');
      nextBtn.className = 'arrow next';
      nextBtn.setAttribute('aria-label','Imagen siguiente');
      nextBtn.innerHTML = '&#8250;';

      prevBtn.addEventListener('click', function(){
        currentIndex = (currentIndex - 1 + imgs.length) % imgs.length;
        mainImg.src = imgs[currentIndex];
        document.querySelectorAll('.thumbnails img').forEach(function(im, i){ im.classList.toggle('active', i === currentIndex); });
      });
      nextBtn.addEventListener('click', function(){
        currentIndex = (currentIndex + 1) % imgs.length;
        mainImg.src = imgs[currentIndex];
        document.querySelectorAll('.thumbnails img').forEach(function(im, i){ im.classList.toggle('active', i === currentIndex); });
      });

      G.appendChild(prevBtn);
      G.appendChild(nextBtn);

      const thumbs = document.createElement('div');
      thumbs.className = 'thumbnails';
      imgs.forEach(function(src, i){
        const t = document.createElement('img');
        t.src = src;
        t.alt = 'Miniatura ' + (i+1);
        t.addEventListener('click', function(){
          currentIndex = i;
          mainImg.src = imgs[currentIndex];
          document.querySelectorAll('.thumbnails img').forEach(function(im, idx){ im.classList.toggle('active', idx === currentIndex); });
        });
        if(i===0) t.classList.add('active');
        thumbs.appendChild(t);
      });

      G.appendChild(thumbs);
      galleryDiv.appendChild(G);

      /* ========== INFO ========== */
      const infoDiv = document.createElement('div');
      infoDiv.className = 'info';
      const h1 = document.createElement('h1');
      h1.textContent = prop.title || 'Propiedad';
      const specs = document.createElement('div');
      specs.className = 'specs';
      const specItems = [
        {icon:'üõèÔ∏è', text:(prop.beds||'‚Äî')+' hab'},
        {icon:'üõÅ', text:(prop.baths||'‚Äî')+' ba√±os'},
        {icon:'üìê', text:(prop.sqm||'‚Äî')+' m¬≤'},
        {icon:'üìç', text:prop.city||'‚Äî'},
      ];
      specItems.forEach(function(s){
        const el = document.createElement('div');
        el.className = 'item';
        el.innerHTML = '<span aria-hidden="true">'+s.icon+'</span> <span>'+s.text+'</span>';
        specs.appendChild(el);
      });

      const priceRow = document.createElement('div');
      priceRow.className = 'price-row';
      const price = document.createElement('div');
      price.className = 'price';
      if(prop.price){
        let suffix = '';
        if(prop.operation === 'arrendar') suffix = ' / mes';
        if(prop.operation === 'dias') suffix = ' / noche';
        price.textContent = '$'+formatCOP(prop.price)+' COP' + suffix;
      }else{
        price.textContent = 'Precio a convenir';
      }
      priceRow.appendChild(price);
      const badge = document.createElement('div');
      badge.className = 'badge';
      badge.innerHTML = 'ID: '+prop.id;
      priceRow.appendChild(badge);

      const desc = document.createElement('p');
      desc.className = 'desc';
      desc.textContent = prop.description || '';

      const actions = document.createElement('div');
      actions.className = 'actions';
      const contactBtn = document.createElement('a');
      contactBtn.href = '#form';
      contactBtn.className = 'btn btn-secondary';
      contactBtn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M2 21l1.5-5.5 10-10 5 5-10 10L2 21z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> Contactar';
      actions.appendChild(contactBtn);
      const whatsapp = document.createElement('a');
      whatsapp.href = buildWhatsAppLink(prop);
      whatsapp.target = '_blank';
      whatsapp.rel = 'noopener';
      whatsapp.className = 'btn';
      whatsapp.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M20.52 3.48A11.94 11.94 0 0 0 12 0C5.37 0 0 5.37 0 12c0 1.88.45 3.66 1.22 5.24L0 24l6.21-1.62A11.96 11.96 0 0 0 12 24c6.63 0 12-5.37 12-12 0-3.19-1.24-6.19-3.48-8.52ZM12 22a9.93 9.93 0 0 1-5.06-1.4l-.36-.21-3.69.96.99-3.59-.23-.37A9.98 9.98 0 1 1 22 12c0 5.52-4.48 10-10 10Zm5.48-7.55c-.3-.15-1.76-.87-2.03-.97-.27-.1-.47-.15-.67.15-.2.3-.77.97-.94 1.17-.17.2-.35.22-.65.07-.3-.15-1.27-.47-2.42-1.49-.89-.79-1.49-1.76-1.66-2.06-.17-.3-.02-.46.13-.61.13-.13.3-.35.46-.52.15-.17.2-.3.3-.5.1-.2.05-.37-.02-.52-.07-.15-.67-1.62-.92-2.22-.24-.58-.49-.5-.67-.5h-.57c-.2 0-.52.07-.79.37-.27.3-1.04 1.02-1.04 2.48s1.07 2.88 1.22 3.08c.15.2 2.1 3.2 5.08 4.49.71.31 1.26.49 1.7.63.71.23 1.36.2 1.87.12.57-.08 1.76-.72 2.01-1.41.25-.69.25-1.28.17-1.41-.08-.13-.27-.2-.57-.35Z" fill="currentColor"/></svg> WhatsApp';
      actions.appendChild(whatsapp);

      infoDiv.appendChild(h1);
      infoDiv.appendChild(specs);
      infoDiv.appendChild(priceRow);
      if(desc.textContent) infoDiv.appendChild(desc);
      infoDiv.appendChild(actions);

      /* ========== FORM CONTACTO (FormSubmit) ========== */
      const form = document.createElement('form');
      form.className = 'contact-form';
      form.action = 'https://formsubmit.co/altorrainmobiliaria@gmail.com';
      form.method = 'POST';
      form.id = 'form';
      form.innerHTML = `
        <h3>Solicitar informaci√≥n</h3>
        <input type="hidden" name="_subject" value="Consulta propiedad ${prop.id} - ${escapeHtml(prop.title)}" />
        <input type="hidden" name="property_id" value="${prop.id}" />
        <input type="hidden" name="property_title" value="${escapeHtml(prop.title)}" />
        <input type="text" name="name" placeholder="Nombre completo" required />
        <input type="email" name="email" placeholder="Correo electr√≥nico" required />
        <input type="tel" name="phone" placeholder="N√∫mero de tel√©fono" required />
        <textarea name="message" placeholder="Mensaje" rows="4" required>Hola, estoy interesado(a) en la propiedad &quot;${escapeHtml(prop.title)}&quot; Por favor cont√°cteme.</textarea>
        <input type="text" name="_honey" style="display:none" tabindex="-1" autocomplete="off" />
        <input type="hidden" name="_captcha" value="false" />
        <input type="hidden" name="_template" value="table" />
        <input type="hidden" name="_next" value="https://altorrainmobiliaria.github.io/gracias.html" />
        <button type="submit" class="btn btn-primary">Enviar mensaje</button>
      `;
      infoDiv.appendChild(form);

      /* ========== MONTAJE ========== */
      container.innerHTML = '';
      container.appendChild(galleryDiv);
      container.appendChild(infoDiv);

      /* ========== SEO: Schema.org ========== */
      try {
        const schema = {
          "@context": "https://schema.org",
          "@type": "Offer",
          "itemOffered": {
            "@type": "Residence",
            "name": prop.title,
            "address": {
              "@type": "PostalAddress",
              "addressLocality": prop.city,
              "addressRegion": "Bol√≠var",
              "addressCountry": "CO"
            },
            "numberOfRooms": prop.beds,
            "numberOfBathroomsTotal": prop.baths,
            "floorSize": {
              "@type": "QuantitativeValue",
              "value": prop.sqm,
              "unitCode": "MTR"
            }
          },
          "price": prop.price,
          "priceCurrency": "COP",
          "availability": "https://schema.org/InStock"
        };
        const ld = document.createElement('script');
        ld.type = 'application/ld+json';
        ld.textContent = JSON.stringify(schema);
        document.head.appendChild(ld);
      } catch(e) { console.warn('Schema injection error', e); }

    }catch(err){
      console.error(err);
      container.innerHTML = '<p>Error al cargar la propiedad.</p>';
    }
  }
  document.addEventListener('DOMContentLoaded', init);
</script>

<!-- Scripts de men√∫ (id√©nticos; NO tocar) -->
<script>
  (function(){
    const MARGIN = 12;
    let open = null;
    const supportsHover = window.matchMedia('(hover: hover)').matches;

    function resetPanelStyles(panel){
      panel.style.left=''; panel.style.top=''; panel.style.width=''; panel.style.maxWidth=''; panel.style.right='';
    }
    function placeAndShow(btn, panel, size){
      if(window.innerWidth <= 860) return;
      if(open && open.panel !== panel) hideImmediate(open);
      resetPanelStyles(panel);
      panel.style.display = 'block';
      panel.style.visibility = 'hidden';
      panel.style.position = 'fixed';
      panel.style.maxHeight = Math.max(260, window.innerHeight - (MARGIN*2)) + 'px';
      if(size === 'mega'){
        panel.style.width = Math.min(920, window.innerWidth - (MARGIN*2)) + 'px';
      } else {
        panel.style.width = 'auto';
        panel.style.maxWidth = Math.min(520, window.innerWidth - (MARGIN*2)) + 'px';
      }
      const preRect = panel.getBoundingClientRect();
      const bRect = btn.getBoundingClientRect();
      let left;
      if(size === 'mega'){
        left = Math.round(bRect.left + bRect.width/2 - preRect.width/2);
        left = Math.max(MARGIN, Math.min(left, window.innerWidth - preRect.width - MARGIN));
      } else {
        left = Math.round(Math.min(bRect.left, window.innerWidth - preRect.width - MARGIN));
        left = Math.max(left, MARGIN);
      }
      let top = Math.round(bRect.bottom + 8);
      if(top + preRect.height > window.innerHeight - MARGIN){
        top = Math.round(bRect.top - preRect.height - 8);
        if(top < MARGIN) top = MARGIN;
      }
      panel.style.left = left + 'px';
      panel.style.top = top + 'px';
      panel.style.visibility = 'visible';
      panel.classList.add('menu-visible');
      panel.setAttribute('aria-hidden','false');
      btn.setAttribute('aria-expanded','true');
      open = {panel, btn};
    }
    function hideImmediate(obj){
      if(!obj) return;
      obj.btn && obj.btn.setAttribute('aria-expanded','false');
      obj.panel.classList.remove('menu-visible');
      obj.panel.style.display='none';
      obj.panel.setAttribute('aria-hidden','true');
      resetPanelStyles(obj.panel);
      if(open && open.panel === obj.panel) open = null;
    }
    document.querySelectorAll('.nav-btn[data-panel]').forEach(btn=>{
      const panelId = btn.getAttribute('data-panel');
      const panel = document.getElementById(panelId);
      const item = btn.closest('.nav-item');
      const size = item ? (item.dataset.size || 'compact') : 'compact';
      let openTimer=null, closeTimer=null;
      const show = ()=> { clearTimeout(closeTimer); openTimer = setTimeout(()=>{ placeAndShow(btn, panel, size); }, 60); };
      const hide = ()=> { clearTimeout(openTimer); closeTimer = setTimeout(()=>{ hideImmediate({panel, btn}); }, 120); };
      if(supportsHover){
        btn.addEventListener('pointerenter', show);
        btn.addEventListener('pointerleave', hide);
        panel.addEventListener('pointerenter', ()=> { clearTimeout(closeTimer); clearTimeout(openTimer); });
        panel.addEventListener('pointerleave', hide);
      }
      btn.addEventListener('click', (e)=> {
        if(window.innerWidth > 860){
          e.preventDefault();
          if(panel.classList.contains('menu-visible')) hideImmediate({panel, btn});
          else placeAndShow(btn, panel, size);
        }
      });
      btn.addEventListener('focus', show);
      btn.addEventListener('blur', ()=> setTimeout(()=>{ if(!panel.contains(document.activeElement)) hide(); }, 60));
    });
    document.addEventListener('click', (e)=>{
      if(e.target.closest('nav') || e.target.closest('.menu-panel')) return;
      document.querySelectorAll('.menu-panel.menu-visible').forEach(p=> hideImmediate({panel:p, btn:null}));
    });
    document.addEventListener('keydown', (e)=> {
      if(e.key === 'Escape'){
        document.querySelectorAll('.menu-panel.menu-visible').forEach(p=> hideImmediate({panel:p, btn:null}));
      }
    });
    window.addEventListener('resize', ()=> {
      document.querySelectorAll('.menu-panel').forEach(p=> { p.classList.remove('menu-visible'); p.style.display='none'; p.setAttribute('aria-hidden','true'); resetPanelStyles(p); });
      document.querySelectorAll('.nav-btn[data-panel]').forEach(b => b.setAttribute('aria-expanded','false'));
      open = null;
    });
  })();

  (function(){
    const toggle = document.getElementById('navToggle');
    const drawer = document.getElementById('mobileMenu');
    const backdrop = document.getElementById('drawerBackdrop');
    if(!toggle || !drawer || !backdrop) return;
    let lastFocus = null;
    function focusable(root){ return root.querySelectorAll('a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])'); }
    function setDrawerHeight(){
      const headerH = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--header-h')) || 72;
      drawer.style.height = (window.innerHeight - headerH) + 'px';
    }
    function clearDrawerHeight(){ drawer.style.height = ''; }
    function openDrawer(){
      lastFocus = document.activeElement;
      drawer.hidden = false;
      setDrawerHeight();
      window.addEventListener('resize', setDrawerHeight);
      window.addEventListener('orientationchange', setDrawerHeight);
      requestAnimationFrame(()=> {
        drawer.classList.add('open');
        backdrop.classList.add('open');
        document.body.style.overflow='hidden';
        toggle.setAttribute('aria-expanded','true');
        const el = focusable(drawer)[0];
        el && el.focus();
      });
    }
    function closeDrawer(){
      drawer.classList.remove('open');
      backdrop.classList.remove('open');
      document.body.style.overflow='';
      toggle.setAttribute('aria-expanded','false');
      clearDrawerHeight();
      window.removeEventListener('resize', setDrawerHeight);
      window.removeEventListener('orientationchange', setDrawerHeight);
      requestAnimationFrame(()=> {
        drawer.hidden = true;
        if(lastFocus) lastFocus.focus();
      });
    }
    toggle.addEventListener('click', ()=> drawer.classList.contains('open') ? closeDrawer() : openDrawer());
    backdrop.addEventListener('click', closeDrawer);
    document.addEventListener('keydown', (e)=> { if(e.key === 'Escape' && drawer.classList.contains('open')) closeDrawer(); });
  })();
</script>
</body>
</html>
