<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="format-detection" content="telephone=no" />
  <title>Detalle de propiedad | Altorra</title>
  <meta name="description" content="Detalles de propiedad de Altorra Inmobiliaria" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#d4af37" />
  <meta property="og:title" content="Detalles de propiedad | Altorra" />
  <meta property="og:description" content="Descubre los detalles de esta propiedad disponible para comprar, arrendar o rentar por días." />
  <meta property="og:image" content="/img/uploads/comprar1.png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700;800&display=swap" rel="stylesheet" />
  <style>
    :root{
      --gold:#d4af37; --accent:#ffb400; --bg:#ffffff; --text:#111827; --muted:#6b7280;
      --header-h:72px; --page-max:1200px; --overlay: rgba(0,0,0,0.30);
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:"Poppins",system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:var(--text);background:transparent;}
    html,body{background:var(--bg);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
    a{text-decoration:none;color:inherit;}
    a[href^="tel"], a[x-apple-data-detectors]{color:inherit !important;text-decoration:none !important;font-weight:inherit !important;border-bottom:0 !important;}

    /* ===== LAYOUT GENERAL ===== */
    main.detail-container{
      max-width:var(--page-max);
      margin:calc(var(--header-h) + 20px) auto 40px;
      padding:0 16px 40px;
      display:grid;
      gap:24px;
      grid-template-columns: 1fr;             /* móvil */
    }
    @media (min-width:980px){
      main.detail-container{
        grid-template-columns: minmax(0,1fr) minmax(0,1fr); /* desktop */
        align-items:start;
      }
    }
    [id]{scroll-margin-top:calc(var(--header-h) + 12px);}

    /* Columna izquierda (galería + CTA + form) */
    .left-stack{
      display:flex;
      flex-direction:column;
      gap:12px;
      max-width:760px;
      margin-inline:auto;
      width:100%;
    }

    /* ===== GALERÍA ===== */
    .gallery{position:relative;overflow:visible;min-width:0;}
    .gallery-inner{position:relative;}
    .main-img{
      width:100%;
      height:clamp(280px, 52vh, 520px); /* altura estable para que el texto no “salte” */
      object-fit:contain;
      border-radius:14px;margin-bottom:10px;background:#f5f5f7;display:block;
      transition:transform .28s ease, box-shadow .28s ease;cursor:zoom-in;box-shadow:0 10px 26px rgba(0,0,0,.06);
    }
    .main-img:hover{transform:scale(1.02);box-shadow:0 16px 36px rgba(0,0,0,.12);}
    .gallery .arrow{
      position:absolute;top:50%;transform:translateY(-50%);width:40px;height:40px;border-radius:999px;border:none;
      background:#fff;color:#111;cursor:pointer;z-index:3;display:flex;align-items:center;justify-content:center;
      box-shadow:0 10px 26px rgba(0,0,0,.12);transition:transform .15s ease, box-shadow .2s ease, opacity .2s ease;
    }
    .gallery .arrow:hover{transform:translateY(-50%) scale(1.05);box-shadow:0 14px 30px rgba(0,0,0,.16);}
    .gallery .arrow.prev{left:10px;} .gallery .arrow.next{right:10px;}

    .thumbnails{display:flex;gap:10px;overflow-x:auto;padding-bottom:2px;scroll-snap-type:x proximity;max-width:100%;}
    .thumbnails::-webkit-scrollbar{height:8px}
    .thumbnails::-webkit-scrollbar-thumb{background:rgba(0,0,0,.12);border-radius:999px}
    .thumbnails img{
      width:96px;height:70px;object-fit:cover;border-radius:10px;flex-shrink:0;cursor:pointer;opacity:.7;border:2px solid transparent;background:#f3f4f6;
      scroll-snap-align:start;transition:opacity .15s ease, border-color .15s ease, transform .15s ease;
    }
    .thumbnails img:hover{opacity:.95;transform:translateY(-1px);}
    .thumbnails img.active{opacity:1;border-color:var(--gold);}

    /* ===== CTA WhatsApp ===== */
    .actions{display:flex;gap:12px;flex-wrap:wrap;justify-content:flex-start;}
    .btn{padding:12px 16px;border-radius:12px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;font-weight:700;}
    .btn.btn-ghost{background:#f5f5f5;color:#111;border:1px solid rgba(0,0,0,0.1);}
    .btn.btn-primary{background:linear-gradient(90deg,var(--accent),#ffd95e);color:#000;border:none;box-shadow:0 10px 22px rgba(0,0,0,.10);}
    .btn svg{width:18px;height:18px;}

    /* ===== INFO (columna derecha) ===== */
    .col-info{display:flex;flex-direction:column;gap:12px;min-width:0;}
    .col-info h1{font-size:2rem;font-weight:800;line-height:1.1;}
    .price{font-weight:800;font-size:1.6rem;color:var(--gold);}
    .desc{color:#1f2937; text-align:justify; line-height:1.75; overflow-wrap:anywhere; word-break:break-word; hyphens:auto;}
    .desc p + p{ margin-top:10px; }

    .status-pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:6px 10px;border-radius:999px;font-weight:700;font-size:.85rem;
      background:#f7f7f8;border:1px solid rgba(17,24,39,.08);
      width:max-content;
    }
    .status-dot{width:10px;height:10px;border-radius:999px;background:#16a34a;}
    .status-pill.unavailable{background:#fcfcfc;opacity:.95;}
    .status-pill.unavailable .status-dot{background:#dc2626;}

    /* Chips de features */
    .details-chips{display:flex;gap:8px;flex-wrap:wrap;}
    .chip{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 10px;border-radius:999px;background:#f5f5f5;border:1px solid rgba(17,24,39,.08);
      font-weight:700;font-size:.9rem;color:#0f172a;
    }
    .chip svg{width:16px;height:16px;display:block}

    /* ===== FORMULARIO ===== */
    .form-wrap{width:100%;}
    .contact-form{display:grid;grid-template-columns:1fr;gap:12px;padding:16px;border:1px solid rgba(17,24,39,.08);border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.05);background:#fff;width:100%;}
    .contact-form h3{margin:0 0 4px;font-size:1.25rem;font-weight:800;color:var(--gold);}
    .contact-form .row-3{display:grid;grid-template-columns:1fr;gap:12px;}
    @media (min-width:720px){.contact-form .row-3{grid-template-columns:repeat(3,1fr);}}
    .contact-form input,.contact-form textarea{width:100%;display:block;padding:12px 14px;border-radius:12px;border:1px solid rgba(17,24,39,.16);font-size:1rem;background:#fff;transition:border-color .15s ease, box-shadow .15s ease;}
    .contact-form textarea{resize:vertical;min-height:110px;}
    .contact-form input:focus-visible,.contact-form textarea:focus-visible{outline:3px solid rgba(212,175,55,0.22);border-color:var(--gold);}
    .contact-form .btn{justify-self:start;}

    /* ===== HEADER / NAV ===== */
    header{position:fixed;top:0;left:0;right:0;height:var(--header-h);display:flex;align-items:center;background:var(--bg);z-index:140;border-bottom:1px solid rgba(0,0,0,0.06);box-shadow:0 8px 26px rgba(0,0,0,0.06);}
    .container{max-width:var(--page-max);margin:0 auto;width:100%;padding:0 16px;display:flex;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;gap:10px;margin-right:6px}
    .brand img{width:48px;height:48px;object-fit:contain}
    nav{margin-left:auto;display:flex;align-items:center;gap:8px}
    .nav-list{display:flex;gap:6px;align-items:center;margin-left:auto}
    .nav-item{position:relative}
    .nav-btn{background:transparent;border:0;padding:8px 12px;font-weight:700;cursor:pointer;border-radius:8px;color:var(--text);font-size:0.95rem}
    .nav-btn:focus{outline:3px solid rgba(212,175,55,0.18);outline-offset:3px}
    .nav-toggle{display:none;margin-left:auto;background:transparent;border:1px solid rgba(0,0,0,.1);border-radius:10px;padding:8px 12px;font-weight:800}
    .menu-panel{display:none;position:fixed;z-index:150;padding:14px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfbfb);border:1px solid rgba(0,0,0,0.06);box-shadow:0 22px 48px rgba(0,0,0,0.12);max-height:calc(100vh - var(--header-h) - 20px);overflow:auto}
    .menu-visible{display:block;opacity:1;transform:none}
    .panel-compact{min-width:220px;max-width:44vw}
    .panel-mega{min-width:360px;max-width:920px;width:min(88vw,920px)}
    .mega-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .mega-col h4{margin:0 0 8px;color:var(--gold);font-weight:700}
    .menu-link{display:block;padding:6px;border-radius:8px;color:#0f1724}
    .menu-link:hover{background:rgba(0,0,0,0.03)}
    .drawer-backdrop{position:fixed;inset:0;background:var(--overlay);backdrop-filter:blur(2px);-webkit-backdrop-filter:blur(2px);z-index:160;opacity:0;pointer-events:none;transition:opacity .2s ease}
    .drawer{position:fixed;left:0;right:0;top:var(--header-h);height:calc(100dvh - var(--header-h));padding-bottom:max(24px, env(safe-area-inset-bottom));background:#fff;z-index:161;transform:translateY(-8px);opacity:0;pointer-events:none;transition:transform .24s ease, opacity .2s ease;overflow:auto;border-top:1px solid rgba(0,0,0,.06);overscroll-behavior:contain;-webkit-overflow-scrolling:touch}
    .drawer.open{transform:none;opacity:1;pointer-events:auto}
    .drawer-backdrop.open{opacity:1;pointer-events:auto}
    .drawer .block{padding:16px;border-bottom:1px solid rgba(0,0,0,.06)}
    .drawer .block:last-child{padding-bottom:max(32px, env(safe-area-inset-bottom))}
    .drawer h4{margin:0 0 8px;color:var(--gold)}
    .drawer a{display:block;padding:8px 2px}
    @media (max-width:860px){.nav-list{display:none}.nav-toggle{display:inline-flex;align-items:center;gap:8px}.menu-panel{display:none !important}}

    /* ===== Footer ===== */
    footer{background:#0b0b0b;color:#fff;padding:36px 16px}
    .footer-grid{
      max-width:var(--page-max);margin:0 auto;
      display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:18px;width:100%;
    }
    @media (max-width:980px){ .footer-grid{grid-template-columns:1fr;} }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="container">
      <a class="brand" href="index.html">
        <img src="https://i.postimg.cc/SsPmBFXt/Chat-GPT-Image-9-ago-2025-10-31-20.png" alt="Logo de Altorra" width="48" height="48"/>
      </a>
      <nav aria-label="Menú principal">
        <div class="nav-list">
          <div class="nav-item" data-size="compact"><button class="nav-btn" data-panel="panel-propiedades" aria-controls="panel-propiedades" aria-expanded="false">Propiedades</button></div>
          <div class="nav-item" data-size="mega"><button class="nav-btn" data-panel="panel-servicios" aria-controls="panel-servicios" aria-expanded="false">Servicios</button></div>
          <div class="nav-item" data-size="compact"><button class="nav-btn" data-panel="panel-nosotros" aria-controls="panel-nosotros" aria-expanded="false">Nosotros</button></div>
          <div class="nav-item"><a class="nav-btn" href="contacto.html">Contacto</a></div>
        </div>
      </nav>
      <button id="navToggle" class="nav-toggle" aria-controls="mobileMenu" aria-expanded="false" aria-label="Abrir menú">☰ Menú</button>
    </div>
  </header>

  <!-- Paneles header -->
  <div id="panel-propiedades" class="menu-panel panel-compact" role="dialog" aria-modal="false" aria-hidden="true">
    <a class="menu-link" href="propiedades-comprar.html">Comprar</a>
    <a class="menu-link" href="propiedades-arrendar.html">Arrendar</a>
    <a class="menu-link" href="propiedades-alojamientos.html">Rentar por días</a>
  </div>
  <div id="panel-servicios" class="menu-panel panel-mega" role="dialog" aria-modal="false" aria-hidden="true">
    <div class="mega-grid">
      <div class="mega-col">
        <h4>Gestión</h4>
        <a class="menu-link" href="servicios-administracion.html">Administración de inmuebles</a>
        <a class="menu-link" href="servicios-avaluos.html">Avalúos</a>
        <a class="menu-link" href="servicios-mantenimiento.html">Mantenimiento y reparaciones</a>
        <a class="menu-link" href="servicios-mudanzas.html">Mudanzas y logística</a>
      </div>
      <div class="mega-col">
        <h4>Jurídico &amp; Contable</h4>
        <a class="menu-link" href="servicios-juridicos.html">Servicios jurídicos</a>
        <a class="menu-link" href="servicios-contables.html">Servicios contables</a>
        <a class="menu-link" href="#">Gestión de contratos</a>
      </div>
      <div class="mega-col">
        <h4>Turismo (Cartagena)</h4>
        <a class="menu-link" href="#">Renta de yates</a>
        <a class="menu-link" href="#">Pasadías en islas</a>
        <a class="menu-link" href="#">Paquetes turísticos</a>
        <a class="menu-link" href="#">Tours históricos</a>
      </div>
    </div>
  </div>
  <div id="panel-nosotros" class="menu-panel panel-compact" role="dialog" aria-modal="false" aria-hidden="true">
    <a class="menu-link" href="quienes-somos.html">Quiénes somos</a>
    <a class="menu-link" href="quienes-somos.html#mision">Misión</a>
    <a class="menu-link" href="quienes-somos.html#vision">Visión</a>
    <a class="menu-link" href="quienes-somos.html#valores">Valores</a>
    <a class="menu-link" href="quienes-somos.html#equipo">Nuestro equipo</a>
  </div>

  <!-- Menú móvil -->
  <div id="drawerBackdrop" class="drawer-backdrop" aria-hidden="true"></div>
  <aside id="mobileMenu" class="drawer" role="dialog" aria-modal="true" aria-labelledby="mobileMenuTitle" hidden>
    <div class="block"><h3 id="mobileMenuTitle" style="margin:0;font-weight:800;color:var(--gold)">Menú</h3></div>
    <div class="block">
      <h4>Propiedades</h4>
      <a href="propiedades-comprar.html">Comprar</a>
      <a href="propiedades-arrendar.html">Arrendar</a>
      <a href="propiedades-alojamientos.html">Rentar por días</a>
    </div>
    <div class="block">
      <h4>Servicios</h4>
      <a href="servicios-administracion.html">Administración de inmuebles</a>
      <a href="servicios-avaluos.html">Avalúos</a>
      <a href="servicios-mantenimiento.html">Mantenimiento y reparaciones</a>
      <a href="servicios-mudanzas.html">Mudanzas y logística</a>
      <a href="servicios-juridicos.html">Servicios jurídicos</a>
      <a href="servicios-contables.html">Servicios contables</a>
      <a href="#">Gestión de contratos</a>
      <h4 style="margin-top:12px">Turismo (Cartagena)</h4>
      <a href="#">Renta de yates</a>
      <a href="#">Pasadías en islas</a>
      <a href="#">Paquetes turísticos</a>
      <a href="#">Tours históricos</a>
    </div>
    <div class="block">
      <h4>Empresa</h4>
      <a href="quienes-somos.html">Quiénes somos</a>
      <a href="contacto.html">Contacto</a>
    </div>
  </aside>

  <main id="propertyDetail" class="detail-container"></main>

  <!-- FOOTER -->
  <footer>
    <div class="footer-grid">
      <div>
        <h3 style="margin:0;color:var(--gold);font-weight:800">ALTORRA INMOBILIARIA</h3>
        <p style="color:#cbd5e1;margin-top:8px;line-height:1.4">
          Administración, Arriendo y Venta de Inmuebles<br/>Avalúos<br/>Servicios Legales Especializados
        </p>
        <div style="margin-top:12px;font-weight:800;color:var(--gold)">+57&nbsp;323&nbsp;501&nbsp;6747</div>
      </div>
      <div>
        <h4 style="margin:0 0 8px;font-weight:700;color:var(--gold)">Propiedades</h4>
        <ul style="margin:0;padding:0;list-style:none;color:#cbd5e1">
          <li><a href="propiedades-comprar.html" style="color:#cbd5e1">Comprar</a></li>
          <li><a href="propiedades-arrendar.html" style="color:#cbd5e1">Arrendar</a></li>
          <li><a href="propiedades-alojamientos.html" style="color:#cbd5e1">Por días</a></li>
        </ul>
      </div>
      <div>
        <h4 style="margin:0 0 8px;font-weight:700;color:var(--gold)">Servicios</h4>
        <ul style="margin:0;padding:0;list-style:none;color:#cbd5e1">
          <li><a href="servicios-administracion.html" style="color:#cbd5e1">Administración</a></li>
          <li><a href="servicios-juridicos.html" style="color:#cbd5e1">Servicios jurídicos</a></li>
          <li><a href="servicios-contables.html" style="color:#cbd5e1">Servicios contables</a></li>
        </ul>
      </div>
      <div>
        <h4 style="margin:0 0 8px;font-weight:700;color:var(--gold)">Empresa</h4>
        <ul style="margin:0;padding:0;list-style:none;color:#cbd5e1">
          <li><a href="quienes-somos.html" style="color:#cbd5e1">Quiénes somos</a></li>
          <li><a href="contacto.html" style="color:#cbd5e1">Contacto</a></li>
        </ul>
      </div>
    </div>
    <div style="max-width:var(--page-max);margin:18px auto 0;color:#9ca3af;text-align:center;font-size:0.9rem">© 2025 Altorra Inmobiliaria — Hecho con confianza.</div>
  </footer>

  <script>
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('/service-worker.js').catch(err=>console.warn('SW registration failed', err));
    }
  </script>

  <!-- Lazy loading -->
  <script>
    document.addEventListener('DOMContentLoaded', ()=> {
      document.querySelectorAll('img').forEach(img => { if(!img.hasAttribute('loading')) img.setAttribute('loading','lazy'); });
    });
  </script>

  <!-- Lógica de detalle -->
  <script>
    function getParam(name){const p=new URLSearchParams(window.location.search);return p.get(name)||'';}
    function formatCOP(n){if(!n&&n!==0)return'';return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,'.');}
    function escapeHtml(s){return String(s||'').replace(/[&<>"]/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));}

    function buildWhatsAppLink(p, opts={}){
      const phone='573235016747', company='Altorra Inmobiliaria';
      const price=p.price?('$'+formatCOP(p.price)+' COP'):'';
      let op=''; if(p.operation==='arrendar') op=' / mes'; else if(p.operation==='dias') op=' / noche';
      const text = opts.customText ?? `Hola ${company}, me interesa la propiedad "${p.title}" (ID: ${p.id}) en ${p.city} ${price}${op}. ¿Podemos agendar una visita?`;
      return 'https://wa.me/'+phone+'?text='+encodeURIComponent(text);
    }

    /* Descripción → párrafos auto */
    function splitIntoParagraphs(text){
      if(!text) return [];
      if(/\n{2,}/.test(text)) return text.split(/\n{2,}/).map(t=>t.trim()).filter(Boolean);
      const sentences = text.trim().split(/(?<=[.!?])\s+(?=[A-ZÁÉÍÓÚÑ0-9])/);
      const paras = []; let bucket = [];
      sentences.forEach(s=>{
        bucket.push(s);
        const tooLong = bucket.join(' ').length > 320;
        if(bucket.length >= 3 || tooLong){ paras.push(bucket.join(' ')); bucket = []; }
      });
      if(bucket.length) paras.push(bucket.join(' '));
      return paras;
    }
    function buildDescription(el, text){
      splitIntoParagraphs(text).forEach(t=>{
        const p=document.createElement('p'); p.textContent=t; el.appendChild(p);
      });
    }

    async function init(){
      const id=getParam('id'), container=document.getElementById('propertyDetail');
      if(!id){container.innerHTML='<p>Propiedad no especificada.</p>';return;}
      try{
        const res=await fetch('properties/data.json',{cache:'no-store'});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const data=await res.json();
        const prop=data.find(it=>it.id===id);
        if(!prop){container.innerHTML='<p>Propiedad no encontrada.</p>';return;}

        const isAvailable = Number(prop.available) === 1;

        /* ==== Estructura base ==== */
        const leftStack=document.createElement('div'); leftStack.className='left-stack';
        const infoDiv=document.createElement('div'); infoDiv.className='col-info';
        const formWrap=document.createElement('div'); formWrap.className='form-wrap';

        /* ==== GALERÍA ==== */
        const gallery=document.createElement('div'); gallery.className='gallery';
        const G=document.createElement('div'); G.className='gallery-inner';

        const imgsRaw=Array.isArray(prop.images)&&prop.images.length?prop.images:['https://i.postimg.cc/0yYb8Y6r/placeholder.png'];
        const imgs=imgsRaw.map(src=> (src.startsWith('http')||src.startsWith('//'))?src:(src.startsWith('/')?src:'/'+src));

        let currentIndex=0;

        const mainImg=document.createElement('img');
        mainImg.className='main-img'; mainImg.decoding='async'; mainImg.src=imgs[0];
        mainImg.alt=escapeHtml(prop.title||'Imagen de la propiedad'); G.appendChild(mainImg);

        const prevBtn=document.createElement('button'); prevBtn.className='arrow prev'; prevBtn.setAttribute('aria-label','Imagen anterior'); prevBtn.innerHTML='&#8249;';
        const nextBtn=document.createElement('button'); nextBtn.className='arrow next'; nextBtn.setAttribute('aria-label','Imagen siguiente'); nextBtn.innerHTML='&#8250;';

        const goPrev=()=>{if(!imgs.length)return; currentIndex=(currentIndex-1+imgs.length)%imgs.length; mainImg.src=imgs[currentIndex]; updateActiveThumb();};
        const goNext=()=>{if(!imgs.length)return; currentIndex=(currentIndex+1)%imgs.length; mainImg.src=imgs[currentIndex]; updateActiveThumb();};

        prevBtn.addEventListener('click', goPrev);
        nextBtn.addEventListener('click', goNext);

        document.addEventListener('keydown', e=>{ if(e.key==='ArrowLeft') goPrev(); if(e.key==='ArrowRight') goNext(); });

        G.appendChild(prevBtn); G.appendChild(nextBtn);

        // Zoom
        mainImg.addEventListener('click', ()=>{
          const overlay=document.createElement('div');
          Object.assign(overlay.style,{position:'fixed',inset:'0',background:'rgba(0,0,0,0.86)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:'9999',cursor:'zoom-out'});
          const zoomImg=document.createElement('img'); Object.assign(zoomImg.style,{maxWidth:'92%',maxHeight:'92%',objectFit:'contain'}); zoomImg.src=mainImg.src;
          overlay.appendChild(zoomImg); overlay.addEventListener('click',()=>overlay.remove()); document.body.appendChild(overlay);
        });

        const thumbs=document.createElement('div'); thumbs.className='thumbnails'; const thumbEls=[];
        imgs.forEach((src,idx)=>{const t=document.createElement('img'); t.decoding='async'; t.src=src; t.alt=escapeHtml(prop.title||'Miniatura');
          if(idx===0) t.classList.add('active');
          t.addEventListener('click',()=>{currentIndex=idx; mainImg.src=imgs[currentIndex]; updateActiveThumb();});
          thumbEls.push(t); thumbs.appendChild(t);
        });
        function updateActiveThumb(){thumbEls.forEach((el,idx)=>el.classList.toggle('active', idx===currentIndex));}

        // Swipe móvil
        let startX=null;
        mainImg.addEventListener('touchstart',e=>{startX=e.touches[0].clientX;},{passive:true});
        mainImg.addEventListener('touchend',e=>{if(startX===null)return; const dx=e.changedTouches[0].clientX-startX; if(Math.abs(dx)>40){dx<0?goNext():goPrev();} startX=null;},{passive:true});

        // Autoplay 3s
        (function autoplay(){
          if(!imgs||imgs.length<2) return;
          const AUTO_MS=3000; let timer=null;
          const start=()=>{ if(!timer) timer=setInterval(goNext, AUTO_MS); };
          const stop =()=>{ if(timer){clearInterval(timer); timer=null;} };
          const restart=()=>{ stop(); start(); };
          prevBtn.addEventListener('click',restart); nextBtn.addEventListener('click',restart); thumbEls.forEach(el=>el.addEventListener('click',restart));
          [G, mainImg, thumbs].forEach(el=>{ el.addEventListener('mouseenter',stop); el.addEventListener('mouseleave',start); el.addEventListener('touchstart',stop,{passive:true}); el.addEventListener('touchend',()=>setTimeout(start,800),{passive:true}); });
          document.addEventListener('visibilitychange',()=>{document.hidden?stop():start();});
          setTimeout(start,100);
        })();

        gallery.appendChild(G);
        gallery.appendChild(thumbs);

        /* ==== CTA WhatsApp (siempre justo debajo de miniaturas) ==== */
        const actions=document.createElement('div'); actions.className='actions';
        const waText = isAvailable ? null : `Hola, me interesa la propiedad "${prop.title}" (ID: ${prop.id}). ¿Podrían avisarme si vuelve a estar disponible?`;
        const whatsapp=document.createElement('a');
        whatsapp.className='btn btn-ghost';
        whatsapp.href = buildWhatsAppLink(prop, { customText: waText });
        whatsapp.target='_blank'; whatsapp.rel='noopener';
        whatsapp.innerHTML='<svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M20.52 3.48A11.89 11.89 0 0 0 12 0C5.37 0 0 5.37 0 12c0 2.11.55 4.17 1.6 5.98L0 24l6.21-1.62A11.96 11.96 0 0 0 12 24c6.63 0 12-5.37 12-12 0-3.19-1.24-6.19-3.48-8.52ZM12 22a9.93 9.93 0 0 1-5.06-1.4l-.36-.21-3.69.96.99-3.59-.23-.37A9.98 9.98 0 1 1 22 12c0 5.52-4.48 10-10 10Zm5.48-7.55c-.3-.15-1.76-.87-2.03-.97-.27-.1-.47-.15-.67.15-.2.3-.77.97-.94 1.17-.17.2-.35.22-.65.07-.3-.15-1.27-.47-2.42-1.49-.89-.79-1.49-1.76-1.66-2.06-.17-.3-.02-.46.13-.61.13-.13.3-.35.46-.52.15-.17.2-.3.3-.5.1-.2.05-.37-.02-.52-.07-.15-.67-1.62-.92-2.22-.24-.58-.49-.5-.67-.5h-.57c-.2 0-.52.07-.79.37-.27.3-1.04 1.02-1.04 2.48s1.07 2.88 1.22 3.08c.15.2 2.1 3.2 5.08 4.49.71.31 1.26.49 1.7.63.71.23 1.36.2 1.87.12.57-.08 1.76-.72 2.01-1.41.25-.69.25-1.28.17-1.41-.08-.13-.27-.2-.57-.35Z" fill="currentColor"/></svg> ' + (isAvailable?'WhatsApp':'Preguntar disponibilidad');
        actions.appendChild(whatsapp);

        /* ==== INFO DERECHA ==== */
        const h1=document.createElement('h1'); h1.textContent=prop.title||'Propiedad';

        const status=document.createElement('div');
        status.className='status-pill'+(isAvailable?'':' unavailable');
        status.innerHTML=`<span class="status-dot"></span>${isAvailable?'Disponible':'No disponible'}`;

        const chips=document.createElement('div'); chips.className='details-chips';
        if(prop.beds){
          const chip=document.createElement('span'); chip.className='chip';
          chip.innerHTML='<svg viewBox="0 0 24 24" fill="none"><path d="M3 10h18M4 10V7a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3m0 0v7M4 17v-4m16 4v-4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>'+`${prop.beds} ${prop.beds===1?'habitación':'habitaciones'}`;
          chips.appendChild(chip);
        }
        if(prop.baths){
          const chip=document.createElement('span'); chip.className='chip';
          chip.innerHTML='<svg viewBox="0 0 24 24" fill="none"><path d="M4 10h12a4 4 0 0 1 4 4v1H4v-1a4 4 0 0 1 0-4Zm1-4a2 2 0 0 1 4 0v4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>'+`${prop.baths} ${prop.baths===1?'baño':'baños'}`;
          chips.appendChild(chip);
        }
        if(prop.sqm){
          const chip=document.createElement('span'); chip.className='chip';
          chip.innerHTML='<svg viewBox="0 0 24 24" fill="none"><path d="M4 4h16v16H4z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/></svg>'+`${prop.sqm} m²`;
          chips.appendChild(chip);
        }

        const priceRow=document.createElement('div'); priceRow.className='price';
        if(prop.price){
          if(prop.operation==='arrendar') priceRow.textContent='$'+formatCOP(prop.price)+' COP / mes';
          else if(prop.operation==='dias') priceRow.textContent='$'+formatCOP(prop.price)+' COP / noche';
          else priceRow.textContent='$'+formatCOP(prop.price)+' COP';
        }

        const desc=document.createElement('div'); desc.className='desc';
        buildDescription(desc, prop.description || '');

        infoDiv.appendChild(h1);
        infoDiv.appendChild(status);
        if(chips.childNodes.length) infoDiv.appendChild(chips);
        infoDiv.appendChild(priceRow);
        if(desc.childNodes.length) infoDiv.appendChild(desc);

        /* ==== FORMULARIO ==== */
        const form=document.createElement('form');
        form.className='contact-form'; form.action='https://formsubmit.co/altorrainmobiliaria@gmail.com'; form.method='POST';
        const msgDefault = isAvailable
          ? `Hola, estoy interesado(a) en la propiedad "${escapeHtml(prop.title)}". Por favor contácteme.`
          : `Hola, me interesa la propiedad "${escapeHtml(prop.title)}". ¿Podrían avisarme si vuelve a estar disponible?`;
        form.innerHTML=`
          <h3>Solicitar información</h3>
          <input type="hidden" name="_subject" value="Consulta propiedad ${prop.id} - ${escapeHtml(prop.title)}" />
          <input type="hidden" name="property_id" value="${prop.id}" />
          <input type="hidden" name="property_title" value="${escapeHtml(prop.title)}" />
          <input type="hidden" name="_honey" value="" />
          <input type="hidden" name="_captcha" value="false" />
          <input type="hidden" name="_template" value="table" />
          <input type="hidden" name="_next" value="https://altorrainmobiliaria.github.io/gracias.html" />
          <div class="row-3">
            <input type="text" name="name" placeholder="Nombre completo" required />
            <input type="email" name="email" placeholder="Correo electrónico" required />
            <input type="tel" name="phone" placeholder="Número de teléfono" required />
          </div>
          <textarea name="message" placeholder="Mensaje" rows="4" required>${msgDefault}</textarea>
          <button type="submit" class="btn btn-primary">${isAvailable ? 'Enviar mensaje' : 'Avisarme'}</button>
        `;
        formWrap.appendChild(form);

        /* ==== MONTAJE (desktop por defecto) ==== */
        leftStack.appendChild(gallery);
        leftStack.appendChild(actions);
        leftStack.appendChild(formWrap);

        container.innerHTML='';
        container.appendChild(leftStack);
        container.appendChild(infoDiv);

        /* ==== Reordenar para móvil: galería → WhatsApp → info → formulario ==== */
        function placeFormForViewport(){
          const isDesktop = window.matchMedia('(min-width:980px)').matches;
          if(isDesktop){
            if(formWrap.parentNode !== leftStack) leftStack.appendChild(formWrap);
            if(container.children[0] !== leftStack){
              container.innerHTML='';
              container.appendChild(leftStack);
              container.appendChild(infoDiv);
            }
          }else{
            // Orden móvil: leftStack (galería+WA), luego info, luego form
            if(container.children[0] !== leftStack){
              container.innerHTML='';
              container.appendChild(leftStack);
              container.appendChild(infoDiv);
            }
            if(formWrap.parentNode !== container){
              container.appendChild(formWrap);
            }else{
              // Garantiza que va al final
              container.appendChild(formWrap);
            }
          }
        }
        placeFormForViewport();
        window.addEventListener('resize', placeFormForViewport);

        /* ==== SEO schema ==== */
        try{
          const schema={
            "@context":"https://schema.org",
            "@type":"Offer",
            "itemOffered":{
              "@type":"Residence",
              "name":prop.title,
              "address":{"@type":"PostalAddress","addressLocality":prop.city,"addressRegion":"Bolívar","addressCountry":"CO"},
              "numberOfRooms":prop.beds,
              "numberOfBathroomsTotal":prop.baths,
              "floorSize":{"@type":"QuantitativeValue","value":prop.sqm,"unitCode":"MTR"}
            },
            "price":prop.price,
            "priceCurrency":"COP",
            "availability": isAvailable ? "https://schema.org/InStock" : "https://schema.org/OutOfStock"
          };
          const ld=document.createElement('script'); ld.type='application/ld+json'; ld.textContent=JSON.stringify(schema); document.head.appendChild(ld);
        }catch(e){console.warn('Schema injection error',e);}
      }catch(err){console.error(err); container.innerHTML='<p>Error al cargar la propiedad.</p>'; }
    }
    document.addEventListener('DOMContentLoaded', init);
  </script>

  <!-- Scripts menú (sin cambios) -->
  <script>
    (function(){
      const MARGIN=12; let open=null; const supportsHover=window.matchMedia('(hover: hover)').matches;
      function reset(p){p.style.left='';p.style.top='';p.style.width='';p.style.maxWidth='';p.style.right='';}
      function show(btn,panel,size){
        if(window.innerWidth<=860) return;
        if(open&&open.panel!==panel) hide(open);
        reset(panel); panel.style.display='block'; panel.style.visibility='hidden'; panel.style.position='fixed';
        panel.style.maxHeight=Math.max(260, window.innerHeight-(MARGIN*2))+'px';
        if(size==='mega'){panel.style.width=Math.min(920, window.innerWidth-(MARGIN*2))+'px';}
        else{panel.style.width='auto'; panel.style.maxWidth=Math.min(520, window.innerWidth-(MARGIN*2))+'px';}
        const pre=panel.getBoundingClientRect(); const b=btn.getBoundingClientRect();
        let left; if(size==='mega'){left=Math.round(b.left+b.width/2-pre.width/2); left=Math.max(MARGIN, Math.min(left, window.innerWidth-pre.width-MARGIN));}
        else{left=Math.round(Math.min(b.left, window.innerWidth-pre.width-MARGIN)); left=Math.max(left,MARGIN);}
        let top=Math.round(b.bottom+8); if(top+pre.height>window.innerHeight-MARGIN){top=Math.round(b.top-pre.height-8); if(top<MARGIN) top=MARGIN;}
        panel.style.left=left+'px'; panel.style.top=top+'px'; panel.style.visibility='visible'; panel.classList.add('menu-visible'); panel.setAttribute('aria-hidden','false'); btn.setAttribute('aria-expanded','true'); open={panel,btn};
      }
      function hide(obj){ if(!obj) return; obj.btn&&obj.btn.setAttribute('aria-expanded','false'); obj.panel.classList.remove('menu-visible'); obj.panel.style.display='none'; obj.panel.setAttribute('aria-hidden','true'); reset(obj.panel); if(open&&open.panel===obj.panel) open=null; }
      document.querySelectorAll('.nav-btn[data-panel]').forEach(btn=>{
        const id=btn.getAttribute('data-panel'); const panel=document.getElementById(id); const item=btn.closest('.nav-item'); const size=item?(item.dataset.size||'compact'):'compact';
        let t1=null,t2=null; const place=()=>{clearTimeout(t2); t1=setTimeout(()=>show(btn,panel,size),60);}; const remove=()=>{clearTimeout(t1); t2=setTimeout(()=>hide({panel,btn}),120);};
        if(supportsHover){btn.addEventListener('pointerenter',place); btn.addEventListener('pointerleave',remove); panel.addEventListener('pointerenter',()=>{clearTimeout(t2); clearTimeout(t1);}); panel.addEventListener('pointerleave',remove);}
        btn.addEventListener('click',e=>{ if(window.innerWidth>860){e.preventDefault(); if(panel.classList.contains('menu-visible')) hide({panel,btn}); else show(btn,panel,size);} });
        btn.addEventListener('focus',place); btn.addEventListener('blur',()=>setTimeout(()=>{ if(!panel.contains(document.activeElement)) remove(); },60));
      });
      document.addEventListener('click',e=>{ if(e.target.closest('nav')||e.target.closest('.menu-panel')) return; document.querySelectorAll('.menu-panel.menu-visible').forEach(p=>hide({panel:p,btn:null})); });
      document.addEventListener('keydown',e=>{ if(e.key==='Escape'){ document.querySelectorAll('.menu-panel.menu-visible').forEach(p=>hide({panel:p,btn:null})); }});
      window.addEventListener('resize',()=>{ document.querySelectorAll('.menu-panel').forEach(p=>{p.classList.remove('menu-visible'); p.style.display='none'; p.setAttribute('aria-hidden','true'); reset(p);}); document.querySelectorAll('.nav-btn[data-panel]').forEach(b=>b.setAttribute('aria-expanded','false')); open=null;});
    })();

    (function(){
      const toggle=document.getElementById('navToggle'), drawer=document.getElementById('mobileMenu'), backdrop=document.getElementById('drawerBackdrop');
      if(!toggle||!drawer||!backdrop) return; let lastFocus=null;
      const focusable=root=>root.querySelectorAll('a,button,input,select,textarea,[tabindex]:not([tabindex="-1"])');
      function setH(){const h=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--header-h'))||72; drawer.style.height=(window.innerHeight-h)+'px';}
      function clearH(){drawer.style.height='';}
      function open(){lastFocus=document.activeElement; drawer.hidden=false; setH(); window.addEventListener('resize',setH); window.addEventListener('orientationchange',setH); requestAnimationFrame(()=>{drawer.classList.add('open'); backdrop.classList.add('open'); document.body.style.overflow='hidden'; toggle.setAttribute('aria-expanded','true'); const el=focusable(drawer)[0]; el&&el.focus();});}
      function close(){drawer.classList.remove('open'); backdrop.classList.remove('open'); document.body.style.overflow=''; toggle.setAttribute('aria-expanded','false'); clearH(); window.removeEventListener('resize',setH); window.removeEventListener('orientationchange',setH); requestAnimationFrame(()=>{drawer.hidden=true; if(lastFocus) lastFocus.focus();});}
      toggle.addEventListener('click',()=>drawer.classList.contains('open')?close():open());
      backdrop.addEventListener('click',close);
      document.addEventListener('keydown',e=>{ if(e.key==='Escape'&&drawer.classList.contains('open')) close(); });
    })();
  </script>
</body>
</html>
