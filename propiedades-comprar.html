<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Altorra — Propiedades en Venta</title>
<meta content="Compra de propiedades con Altorra: atención personalizada y asesoría jurídica." name="description"/>
<!-- PWA y redes sociales -->
<link href="manifest.json" rel="manifest"/>
<meta content="#d4af37" name="theme-color"/>
<meta content="Propiedades en venta | Altorra" property="og:title"/>
<meta content="Descubre las mejores propiedades en venta en Cartagena y otras ciudades. Filtra por ciudad, tipo y precio con Altorra." property="og:description"/>
<meta content="hero-about.webp" property="og:image"/>
<!-- Tipografía y estilos globales -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700;800&amp;display=swap" rel="stylesheet"/>
<link href="style.css" rel="stylesheet"/>
<!-- Estilos específicos de la página de propiedades -->
<style>
    :root{--card-radius:14px;--badge-h:28px;}
    main{padding-top:calc(var(--header-h) + 12px);max-width:var(--page-max);margin:0 auto}
    /* Filtros */
    .filters{display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap;padding:12px 16px;background:#fff;border-radius:12px;margin:16px;border:1px solid rgba(0,0,0,.06)}
    .filters .control{display:flex;flex-direction:column;gap:6px}
    .filters label{font-weight:700;font-size:.85rem;color:var(--muted)}
    .filters input[type="text"], .filters select, .filters input[type="number"]{padding:10px 12px;border-radius:10px;border:1px solid rgba(0,0,0,.08);min-width:160px}
    .filters .actions{margin-left:auto;display:flex;gap:8px;align-items:center}
    .btn{padding:10px 14px;border-radius:10px;font-weight:800;border:0}
    .btn-primary{background:linear-gradient(90deg,var(--accent),#ffd95e);color:#111;box-shadow:0 10px 22px rgba(0,0,0,.08)}
    .btn-ghost{background:transparent;border:1px solid rgba(0,0,0,.08);color:var(--text)}
    /* Grilla de tarjetas */
    .grid{display:grid;gap:18px;padding:16px;grid-template-columns:repeat(3,1fr)}
    @media (max-width:1024px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:720px){.grid{grid-template-columns:1fr}}
    /* Tarjeta */
    .card{background:#fff;border-radius:var(--card-radius);overflow:hidden;border:1px solid rgba(0,0,0,.06);
      box-shadow:0 8px 24px rgba(0,0,0,.06);display:flex;flex-direction:column;transition:transform .18s ease, box-shadow .18s ease;cursor:pointer}
    .card:hover{transform:translateY(-4px);box-shadow:0 16px 36px rgba(0,0,0,.12)}
    .media{position:relative;overflow:hidden;background:#f5f5f5;aspect-ratio:4/3}
    .placeholder{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-weight:800;color:#7a7a7a;font-size:1.05rem}
    .placeholder span{background:#fff;border:1px dashed #d0d0d0;border-radius:10px;padding:6px 10px;opacity:.9}
    .media img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .badges{position:absolute;left:10px;top:10px;display:flex;gap:6px;flex-wrap:wrap;max-width:calc(100% - 64px)}
    .badge{height:var(--badge-h);display:inline-flex;align-items:center;gap:6px;padding:0 10px;border-radius:999px;font-size:12px;font-weight:800;letter-spacing:.2px;
      background:rgba(255,255,255,.9);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);border:1px solid rgba(0,0,0,.06);white-space:nowrap;line-height:var(--badge-h)}
    .badge--dark{background:rgba(17,24,39,.9);color:#fff}
    .fav-btn{position:absolute;top:10px;right:10px;background:rgba(255,255,255,.95);border-radius:999px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border:0;box-shadow:0 6px 18px rgba(0,0,0,.08)}
    .fav-btn .heart{font-size:18px;color:#b7b7b7;transition:transform .12s ease,color .12s ease}
    .fav-btn[aria-pressed="true"] .heart{color:var(--accent);transform:scale(1.07)}
    .meta{padding:12px 14px;display:flex;flex-direction:column;gap:8px}
    .meta h3{margin:0;font-size:1.05rem;line-height:1.2;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;min-height:2.4em}
    .price{font-weight:900;color:var(--gold);font-size:1.05rem}
    .specs{color:var(--muted);font-size:.95rem}
    /* CTA dentro de la tarjeta */
    .cta{display:flex;gap:8px;margin-top:8px;flex-wrap:nowrap;align-items:center;justify-content:stretch}
    .cta .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;flex:1 1 0;min-width:0;padding:8px 10px;font-size:0.92rem;line-height:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;border-radius:10px}
    .cta .btn-primary{background:linear-gradient(90deg,var(--accent),#ffd95e);color:#111;box-shadow:0 8px 18px rgba(0,0,0,.08);border:0}
    .cta .btn-ghost{background:transparent;border:1px solid rgba(0,0,0,.08);color:var(--text)}
    .cta a.btn{display:inline-flex}
    @media (max-width:480px){.cta .btn{padding:6px 8px;font-size:0.84rem}}
    /* Modal contacto */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(2px);-webkit-backdrop-filter:blur(2px);display:none;z-index:500}
    .modal-backdrop.open{display:block}
    .modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:min(720px,92vw);background:#fff;border-radius:16px;border:1px solid rgba(0,0,0,.06);box-shadow:0 24px 64px rgba(0,0,0,.22);display:none;z-index:501}
    .modal.open{display:block}
    .modal header{all:unset;display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid rgba(0,0,0,.06)}
    .modal h3{margin:0;font-weight:800}
    .modal .close{background:transparent;border:0;font-size:20px;cursor:pointer}
    .modal .content{padding:14px 16px}
    .lead-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:720px){.lead-grid{grid-template-columns:1fr}}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-weight:700;font-size:.9rem;color:var(--muted)}
    .field input,.field textarea,.field select{padding:10px 12px;border-radius:10px;border:1px solid rgba(0,0,0,.08)}
    .field textarea{min-height:96px;resize:vertical}
    .modal footer{padding:14px 16px;border-top:1px solid rgba(0,0,0,.06);display:flex;gap:10px;justify-content:flex-end}
    .note{color:#6b7280;font-size:.85rem}
    /* Footer grid para coherencia */
    footer{background:#0b0b0b;color:#fff;padding:36px 16px}
    .footer-grid{max-width:var(--page-max);margin:0 auto;display:grid;grid-template-columns:repeat(4,1fr);gap:18px}
    @media (max-width:920px){.footer-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
<a class="skip-link" href="#main">Saltar al contenido principal</a>
<div id="header-placeholder"></div>
<!-- Registrar service worker si está disponible -->
<script>
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('/service-worker.js').catch(function(err){ console.warn('SW registration failed', err); });
    }
  </script>
<main id="main" style="padding-bottom:32px">
<!-- Filtros -->
<section aria-label="Filtros de búsqueda" class="filters">
<div class="control">
<label for="f-city">Ciudad</label>
<input id="f-city" placeholder="Ej. Cartagena" type="text"/>
</div>
<div class="control">
<label for="f-type">Tipo</label>
<select id="f-type">
<option value="">Cualquiera</option>
<option value="apartamento">Apartamento</option>
<option value="casa">Casa</option>
<option value="lote">Lote</option>
<option value="oficina">Oficina</option>
</select>
</div>
<div class="control">
<label for="f-min">Precio min (COP)</label>
<input id="f-min" min="0" placeholder="0" type="number"/>
</div>
<div class="control">
<label for="f-max">Precio max (COP)</label>
<input id="f-max" min="0" placeholder="—" type="number"/>
</div>
<div class="control">
<label for="f-sort">Ordenar</label>
<select id="f-sort">
<option value="relevance">Relevancia</option>
<option value="price-asc">Precio ↑</option>
<option value="price-desc">Precio ↓</option>
</select>
</div>
<div class="actions">
<button class="btn btn-ghost" id="btnClear" type="button">Limpiar</button>
<button class="btn btn-primary" id="btnApply" type="button">Aplicar filtros</button>
</div>
</section>
<!-- Grid de propiedades -->
<section aria-label="Resultados">
<div aria-live="polite" class="grid" id="list" role="list"></div>
<div style="display:flex;justify-content:center;margin:22px">
<button class="btn btn-ghost" id="btnLoadMore" style="padding:12px 20px">Cargar más</button>
</div>
</section>
</main>
<!-- Modal de contacto -->
<div aria-hidden="true" class="modal-backdrop" id="leadBackdrop"></div>
<section aria-labelledby="leadTitle" aria-modal="true" class="modal" hidden="" id="leadModal" role="dialog">
<header>
<h3 id="leadTitle">Contacto</h3>
<button aria-label="Cerrar" class="close" type="button">✕</button>
</header>
<div class="content">
<form id="leadForm" method="POST" target="leadTarget">
<div class="lead-grid">
<div class="field">
<label for="lead-name">Nombre completo</label>
<input id="lead-name" name="entry.name" placeholder="Tu nombre" required="" type="text"/>
</div>
<div class="field">
<label for="lead-phone">Teléfono</label>
<input id="lead-phone" name="entry.phone" placeholder="+57 ..." required="" type="tel"/>
</div>
<div class="field">
<label for="lead-email">Correo</label>
<input id="lead-email" name="entry.email" placeholder="tucorreo@email.com" required="" type="email"/>
</div>
<div class="field">
<label for="lead-date">Fecha</label>
<input id="lead-date" name="entry.date" required="" type="datetime-local"/>
</div>
<div class="field" style="grid-column:1/-1">
<label for="lead-property">Propiedad de interés</label>
<input id="lead-property" name="entry.property" readonly="" type="text"/>
<input id="lead-url" name="entry.url" type="hidden"/>
</div>
<div class="field" style="grid-column:1/-1">
<label for="lead-message">Mensaje</label>
<textarea id="lead-message" name="entry.message" placeholder="Cuéntanos qué necesitas..."></textarea>
</div>
</div>
<p class="note" style="margin-top:8px">Protegemos tus datos. Un asesor te contactará muy pronto.</p>
<!-- Campos ocultos para Google Forms -->
<input id="g-name" type="hidden"/>
<input id="g-phone" type="hidden"/>
<input id="g-email" type="hidden"/>
<input id="g-date" type="hidden"/>
<input id="g-property" type="hidden"/>
<input id="g-url" type="hidden"/>
<input id="g-message" type="hidden"/>
</form>
</div>
<footer>
<button class="btn btn-ghost" id="leadCancel" type="button">Cancelar</button>
<button class="btn btn-primary" id="leadSubmit" type="button">Enviar</button>
</footer>
<iframe hidden="" id="leadTarget" name="leadTarget"></iframe>
</section>
<div id="footer-placeholder"></div>
<!-- Lógica de propiedades y filtros -->
<script>
/* ===== Cache JSON local (TTL + revalidación background) ===== */
const __ALT_NS = 'altorra:json:';
const __ALT_VER = '2025-09-07.1';
function __jsonKey(url){ return __ALT_NS + url + '::' + __ALT_VER; }
function __now(){ return Date.now(); }
async function getJSONCached(url, { ttlMs = 1000*60*60*6, revalidate = true } = {}){
  let cached = null;
  try {
    const raw = localStorage.getItem(__jsonKey(url));
    if (raw) {
      const obj = JSON.parse(raw);
      if (obj && obj.t && (__now() - obj.t) < ttlMs && obj.data) cached = obj.data;
    }
  } catch(_) {}
  if (cached) {
    if (revalidate) {
      fetch(url, { cache:'no-store' })
        .then(r => r.ok ? r.json() : Promise.reject(r.status))
        .then(data => {
          try { localStorage.setItem(__jsonKey(url), JSON.stringify({ t: __now(), data })); } catch(_){}
          document.dispatchEvent(new CustomEvent('altorra:json-updated', { detail: { url } }));
        })
        .catch(()=>{});
    }
    return cached;
  }
  const res = await fetch(url, { cache:'no-store' });
  if (!res.ok) throw new Error('HTTP '+res.status);
  const data = await res.json();
  try { localStorage.setItem(__jsonKey(url), JSON.stringify({ t: __now(), data })); } catch(_){}
  return data;
}


    /* ---------------- Helpers ---------------- */
    // Estas funciones se utilizan en la creación de tarjetas y deben declararse
    // antes de ejecutar la lógica de carga de propiedades. Se tomaron de las
    // páginas de arriendo y alojamientos para asegurar su disponibilidad.
    const isTouch = () => window.matchMedia('(hover: none)').matches || 'ontouchstart' in window;
    function formatCOP(n){ return (n||0).toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.'); }
    function capitalize(s){ s = String(s||''); return s.charAt(0).toUpperCase() + s.slice(1); }
    function escapeHtml(s){ return String(s||'').replace(/[&<>\"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

    document.addEventListener('DOMContentLoaded', function(){
      // Definir modo de página y etiquetas de precios
      const PAGE_MODE = 'comprar';
      function getPriceLabel(p){
        // Para venta se muestra precio único en COP
        return '$' + formatCOP(p.price) + ' COP';
      }
      const WHATSAPP = { phone:'573235016747', company:'Altorra Inmobiliaria' };
      let sampleProperties = [];
      const operation = 'comprar';
      let renderedCount = 0;
      const PAGE_SIZE = 6;
      function buildWhatsAppLink(p){
        const detailsUrl = new URL('detalle-propiedad.html?id='+encodeURIComponent(p.id), location.href).href;
        const price = getPriceLabel(p);
        const text = `Hola ${WHATSAPP.company}, me interesa la propiedad "${p.title}" (ID: ${p.id}) en ${p.city} por ${price}. ¿Podemos agendar una visita? Detalles: ${detailsUrl}`;
        return `https://wa.me/${WHATSAPP.phone}?text=${encodeURIComponent(text)}`;
      }
      function createCard(p){
        const card = document.createElement('article');
        card.className = 'card';
        card.setAttribute('role','listitem');
        card.innerHTML = `
          <div class="media">
            <img src="${escapeHtml(p.image ? (p.image.startsWith('/') ? p.image : '/' + p.image) : 'https://i.postimg.cc/0yYb8Y6r/placeholder.png')}" alt="${escapeHtml(p.title || 'Propiedad')}" loading="lazy" decoding="async"/>
            <div class="badges">
              <span class="badge"><small>Ciudad</small>&nbsp;${escapeHtml(p.city)}</span>
              <span class="badge badge--dark">${capitalize(p.type)}</span>
              ${p.sqm ? `<span class="badge">${p.sqm} m²</span>` : ``}
              ${(p.beds||0)>0 ? `<span class="badge">${p.beds}H · ${p.baths||0}B</span>` : ``}
            </div>
            <button class="fav-btn" type="button" aria-label="Guardar favorito" aria-pressed="false"><span class="heart">♡</span></button>
          </div>
          <div class="meta">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
              <h3>${escapeHtml(p.title)}</h3>
              <div class="price">${getPriceLabel(p)}</div>
            </div>
            <div class="specs">${p.beds ? p.beds+'H · ' : ''}${p.baths? p.baths+'B · ' : ''}${p.sqm? p.sqm+' m² · ' : ''}${escapeHtml(p.city)} · ${capitalize(p.type)}</div>
            <div class="cta">
              <a class="btn btn-primary" href="detalle-propiedad.html?id=${encodeURIComponent(p.id)}">Ver detalles</a>
              <a class="btn btn-ghost" href="${buildWhatsAppLink(p)}" target="_blank" rel="noopener">WhatsApp</a>
            </div>
          </div>
        `;
        const fav = card.querySelector('.fav-btn');
        fav && fav.addEventListener('click', (e)=>{
          const btn = e.currentTarget; const pressed = btn.getAttribute('aria-pressed')==='true';
          btn.setAttribute('aria-pressed', pressed ? 'false':'true');
          btn.querySelector('.heart').textContent = pressed ? '♡' : '♥';
          e.stopPropagation();
        });
        card.addEventListener('click', (e)=> {
          if(e.target.closest('.cta') || e.target.closest('.fav-btn')) return;
          window.location.href = 'detalle-propiedad.html?id=' + encodeURIComponent(p.id);
        });
        return card;
      }
      function renderList(items, replace){
        const root = document.getElementById('list');
        if(!root) return;
        if(replace) root.innerHTML='';
        items.forEach(p=> root.appendChild(createCard(p)));
      }
      function applyFilters({city,type,min,max,sort}){
        let arr = sampleProperties.slice();
        if(city) arr = arr.filter(p=> p.city.toLowerCase().includes(city.toLowerCase()));
        if(type) arr = arr.filter(p=> p.type===type);
        if(min){ const v = Number(min); arr = arr.filter(p=> p.price >= (isNaN(v)?0:v)); }
        if(max){ const v = Number(max); arr = arr.filter(p=> p.price <= (isNaN(v)?Infinity:v)); }
        if(sort==='price-asc') arr.sort((a,b)=>a.price-b.price);
        if(sort==='price-desc') arr.sort((a,b)=>b.price-a.price);
        return arr;
      }
      const btnApply   = document.getElementById('btnApply');
      const btnClear   = document.getElementById('btnClear');
      const btnLoadMore= document.getElementById('btnLoadMore');
      const list       = document.getElementById('list');
      function updateLoadMoreVisibility(filtered){
        if(!btnLoadMore) return;
        btnLoadMore.style.display = filtered.length > renderedCount ? 'inline-block' : 'none';
      }
      if(btnApply) btnApply.addEventListener('click', ()=>{
        const city = document.getElementById('f-city')?.value.trim()||'';
        const type = document.getElementById('f-type')?.value||'';
        const min  = document.getElementById('f-min')?.value||'';
        const max  = document.getElementById('f-max')?.value||'';
        const sort = document.getElementById('f-sort')?.value||'relevance';
        const filtered = applyFilters({city,type,min,max,sort});
        renderedCount = Math.min(PAGE_SIZE, filtered.length);
        list.dataset.filtered = JSON.stringify(filtered);
        renderList(filtered.slice(0, renderedCount), true);
        updateLoadMoreVisibility(filtered);
      });
      if(btnClear) btnClear.addEventListener('click', ()=>{
        document.getElementById('f-city').value='';
        document.getElementById('f-type').value='';
        document.getElementById('f-min').value='';
        document.getElementById('f-max').value='';
        document.getElementById('f-sort').value='relevance';
        renderedCount = Math.min(PAGE_SIZE, sampleProperties.length);
        list.dataset.filtered = JSON.stringify(sampleProperties);
        renderList(sampleProperties.slice(0, renderedCount), true);
        updateLoadMoreVisibility(sampleProperties);
      });
      if(btnLoadMore) btnLoadMore.addEventListener('click', ()=>{
        let filtered = [];
        try{ filtered = JSON.parse(list.dataset.filtered||'null') || sampleProperties; }catch(e){ filtered = sampleProperties; }
        const next = filtered.slice(renderedCount, renderedCount + PAGE_SIZE);
        renderList(next, false);
        renderedCount += next.length;
        updateLoadMoreVisibility(filtered);
      });
      // Render inicial: cargar propiedades
      (async function init(){
    try {
      const allProps = await getJSONCached('properties/data.json', { ttlMs: 1000*60*60*6, revalidate: true });
      const __syn = ["comprar", "venta", "ventas", "sell", "sale"];
      sampleProperties = Array.isArray(allProps) ? allProps.filter(p => __syn.includes(String(p.operation||'').toLowerCase().trim())) : [];
    } catch(err){
      console.error('Error loading properties:', err);
      sampleProperties = [];
    }
    // Prefill desde URL y primer render filtrado
    const qs = new URLSearchParams(location.search);
    const city = qs.get('city') || '';
    const type = qs.get('type') || '';
    const min  = qs.get('min')  || '';
    const max  = qs.get('max')  || '';
    const sort = qs.get('sort') || 'relevance';
    if (document.getElementById('f-city')) document.getElementById('f-city').value = city;
    if (document.getElementById('f-type') && type) document.getElementById('f-type').value = type;
    if (document.getElementById('f-min') && min) document.getElementById('f-min').value = min;
    if (document.getElementById('f-max') && max) document.getElementById('f-max').value = max;
    if (document.getElementById('f-sort') && sort) document.getElementById('f-sort').value = sort;

    let initial = applyFilters({city,type,min,max,sort});
    renderedCount = Math.min(PAGE_SIZE, initial.length);
    list.dataset.filtered = JSON.stringify(initial);
    renderList(initial.slice(0, renderedCount), true);
    updateLoadMoreVisibility(initial);
  })();;
      // --- Modal contacto (se reutiliza del detalle) ---
      const leadBackdrop = document.getElementById('leadBackdrop');
      const leadModal    = document.getElementById('leadModal');
      const leadForm     = document.getElementById('leadForm');
      const leadSubmit   = document.getElementById('leadSubmit');
      const leadCancel   = document.getElementById('leadCancel');
      const leadClose    = leadModal.querySelector('.close');
      const leadDate     = document.getElementById('lead-date');
      const leadConfig = {
        enabled:false,
        formAction:"https://docs.google.com/forms/d/e/FORM_ID_REAL/formResponse",
        entries:{name:"entry.1111111111", phone:"entry.2222222222", email:"entry.3333333333", date:"entry.4444444444", property:"entry.5555555555", url:"entry.6666666666", message:"entry.7777777777"},
        demo:false
      };
      function nowLocalISO(){
        const d = new Date(); const pad=n=>String(n).padStart(2,'0');
        return d.getFullYear()+"-"+pad(d.getMonth()+1)+"-"+pad(d.getDate())+"T"+pad(d.getHours())+":"+pad(d.getMinutes());
      }
      if(leadDate) leadDate.value = nowLocalISO();
      let lastFocus = null;
      function openLeadModal(prop){
        lastFocus = document.activeElement;
        document.getElementById('lead-property').value = `${prop.title} — ${prop.city} — ${capitalize(prop.type)} — $${formatCOP(prop.price)} COP (ID ${prop.id})`;
        document.getElementById('lead-url').value = prop.url;
        leadModal.hidden = false;
        leadBackdrop.classList.add('open');
        leadModal.classList.add('open');
        setTimeout(()=> document.getElementById('lead-name').focus(), 0);
        document.body.style.overflow='hidden';
      }
      function closeLeadModal(){
        leadBackdrop.classList.remove('open');
        leadModal.classList.remove('open');
        document.body.style.overflow='';
        setTimeout(()=>{ leadModal.hidden = true; }, 160);
        lastFocus && lastFocus.focus();
        leadForm.reset();
        document.getElementById('lead-date').value = nowLocalISO();
      }
      leadCancel.addEventListener('click', closeLeadModal);
      leadClose.addEventListener('click', closeLeadModal);
      leadBackdrop.addEventListener('click', closeLeadModal);
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && !leadModal.hidden) closeLeadModal(); });
      function buildMailto(){
        const name = document.getElementById('lead-name').value.trim();
        const phone= document.getElementById('lead-phone').value.trim();
        const email= document.getElementById('lead-email').value.trim();
        const date = document.getElementById('lead-date').value;
        const prop = document.getElementById('lead-property').value;
        const url  = document.getElementById('lead-url').value;
        const msg  = document.getElementById('lead-message').value.trim();
        const subject = `Interés en propiedad — ${prop}`;
        const body = `Fecha: ${date}\nNombre: ${name}\nTeléfono: ${phone}\nCorreo: ${email}\nPropiedad: ${prop}\nURL: ${url}\n\nMensaje:\n${msg}\n`;
        return `mailto:ventas@altorra.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      }
      function mapToGoogleForm(){
        const e = leadConfig.entries;
        const map = [
          {src:'lead-name',     hid:'g-name',     name:e.name},
          {src:'lead-phone',    hid:'g-phone',    name:e.phone},
          {src:'lead-email',    hid:'g-email',    name:e.email},
          {src:'lead-date',     hid:'g-date',     name:e.date},
          {src:'lead-property', hid:'g-property', name:e.property},
          {src:'lead-url',      hid:'g-url',      name:e.url},
          {src:'lead-message',  hid:'g-message',  name:e.message},
        ];
        map.forEach(m=>{
          const src = document.getElementById(m.src);
          const hid = document.getElementById(m.hid);
          if(!hid || !src) return;
          hid.name = m.name;
          hid.value = src.value;
        });
        leadForm.action = leadConfig.formAction;
      }
      let submitting = false;
      document.getElementById('leadTarget').addEventListener('load', ()=>{
        if(!submitting) return;
        submitting = false;
        try { alert('¡Gracias! Hemos recibido tu solicitud. Te contactaremos pronto.'); }
        catch(e){}
        closeLeadModal();
      });
      leadSubmit.addEventListener('click', ()=>{
        if(!leadForm.reportValidity()) return;
        if(leadConfig.enabled && !leadConfig.demo){
          mapToGoogleForm();
          submitting = true;
          leadForm.submit();
        }else if(leadConfig.demo){
          console.log('[DEMO] Enviando a Google Forms:', { action: leadConfig.formAction, entries: leadConfig.entries });
          alert('DEMO: Datos validados. Configura formAction y entries para enviar a Google Forms.');
          closeLeadModal();
        }else{
          window.location.href = buildMailto();
          closeLeadModal();
        }
      });
      // Exponer para tarjetas
      window.openLeadModal = openLeadModal;
    });
  </script>
<!-- Inserción dinámica del header y footer -->
<script defer="" src="header-footer.js"></script>
</body>
</html>
