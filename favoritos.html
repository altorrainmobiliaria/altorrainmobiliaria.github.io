<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Mis Favoritos | Altorra</title>
  <meta name="description" content="Propiedades guardadas en Altorra Inmobiliaria"/>
  <link rel="manifest" href="manifest.json"/>
  <meta name="theme-color" content="#d4af37"/>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="style.css"/>
  
  <style>
    main {
      padding-top: calc(var(--header-h) + 20px);
      max-width: var(--page-max);
      margin: 0 auto 60px;
      padding-left: 16px;
      padding-right: 16px;
    }

    .page-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .page-header h1 {
      font-size: clamp(2rem, 4vw, 2.8rem);
      font-weight: 800;
      color: var(--gold);
      margin: 0 0 10px;
    }

    .page-header p {
      color: var(--muted);
      font-size: 1.1rem;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }

    .empty-state .icon {
      font-size: 80px;
      margin-bottom: 20px;
      opacity: 0.3;
    }

    .empty-state h2 {
      font-size: 1.8rem;
      font-weight: 800;
      margin: 0 0 10px;
    }

    .empty-state p {
      color: var(--muted);
      margin-bottom: 30px;
    }

    .empty-state .btn {
      display: inline-block;
      padding: 12px 24px;
      background: linear-gradient(90deg, var(--accent), #ffd95e);
      color: #111;
      border-radius: 12px;
      font-weight: 800;
      text-decoration: none;
      transition: transform .15s ease;
    }

    .empty-state .btn:hover {
      transform: translateY(-2px);
    }

    .grid {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(3, 1fr);
    }

    @media (max-width: 1024px) {
      .grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 720px) {
      .grid { grid-template-columns: 1fr; }
    }

    .fav-card {
      background: #fff;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: 0 8px 24px rgba(0,0,0,.06);
      transition: transform .18s ease, box-shadow .18s ease;
      cursor: pointer;
      position: relative;
    }

    .fav-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 36px rgba(0,0,0,.12);
    }

    .fav-card .media {
      position: relative;
      width: 100%;
      height: 200px;
      background: #f5f5f5;
    }

    .fav-card .media img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .fav-card .remove-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: rgba(239, 68, 68, 0.95);
      color: #fff;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      transition: transform .15s ease;
      z-index: 2;
    }

    .fav-card .remove-btn:hover {
      transform: scale(1.1);
      background: rgba(220, 38, 38, 1);
    }

    .fav-card .meta {
      padding: 14px;
    }

    .fav-card h3 {
      font-size: 1.1rem;
      font-weight: 700;
      margin: 0 0 8px;
      color: var(--text);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .fav-card .price {
      font-size: 1.2rem;
      font-weight: 800;
      color: var(--gold);
      margin-bottom: 8px;
    }

    .fav-card .specs {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .actions-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .actions-bar .count {
      font-weight: 700;
      color: var(--muted);
    }

    .actions-bar .btn-clear {
      padding: 8px 16px;
      background: transparent;
      border: 1px solid rgba(0,0,0,.12);
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      color: var(--text);
      transition: background .15s ease;
    }

    .actions-bar .btn-clear:hover {
      background: rgba(239, 68, 68, 0.1);
      border-color: rgba(239, 68, 68, 0.3);
    }
  </style>
</head>

<body>
  <a class="skip-link" href="#main">Saltar al contenido</a>
  <div id="header-placeholder"></div>

  <main id="main">
    <div class="page-header">
      <h1>Mis Favoritos</h1>
      <p>Propiedades que has guardado</p>
    </div>

    <div class="actions-bar" id="actions-bar" style="display:none">
      <div class="count" id="fav-count"></div>
      <button class="btn-clear" id="btn-clear-all">Limpiar todo</button>
    </div>

    <div id="favorites-grid" class="grid"></div>

   <div id="empty-state" class="empty-state" style="display:none">
  <div class="icon">♡</div>
  <h2>No tienes favoritos aún</h2>
  <p>Explora propiedades y agrega tus favoritos</p>

  <!-- Agrupador para controlar el layout responsivo -->
  <div class="btn-group">
    <a href="propiedades-comprar.html" class="btn">Propiedades en Venta</a>
    <a href="propiedades-arrendar.html" class="btn">Propiedades en Arriendo</a>
    <a href="propiedades-alojamientos.html" class="btn">Alojamientos por Días</a>
  </div>
</div>

<style>
  /* MOBILE-FIRST: en móvil se apilan (columna) y ocupan ancho completo del contenedor */
  .empty-state .btn-group {
    display: flex;
    flex-direction: column;
    gap: 10px;              /* espacio entre botones */
    align-items: stretch;   /* que cada botón ocupe el ancho disponible */
  }
  .empty-state .btn {
    display: inline-flex;   /* respeta márgenes y centra contenido */
    justify-content: center;
    align-items: center;
    width: 100%;            /* en móvil, botón a lo ancho */
    text-align: center;
  }

  /* DESKTOP/TABLET: desde 768px, en fila con espacio y ancho mínimo */
  @media (min-width: 768px) {
    .empty-state .btn-group {
      flex-direction: row;
      justify-content: center;
      align-items: center;
      gap: 12px;            /* espacio horizontal entre botones */
    }
    .empty-state .btn {
      width: auto;          /* que ya no ocupen 100% */
      min-width: 220px;     /* opcional: tamaño visual consistente */
    }
  }
</style>

  </main>

  <div id="footer-placeholder"></div>

  <script src="header-footer.js" defer></script>
  
  <script>
    function formatCOP(n) {
      if (!n && n !== 0) return '';
      return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    }

    function capitalize(str) {
      if (!str) return '';
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function renderFavorites() {
      // Obtener favoritos del localStorage directamente
      let favs = [];
      try {
        const raw = localStorage.getItem('altorra:favoritos');
        if (raw) {
          favs = JSON.parse(raw);
          if (!Array.isArray(favs)) favs = [];
        }
      } catch (e) {
        console.error('Error al cargar favoritos:', e);
        favs = [];
      }

      const grid = document.getElementById('favorites-grid');
      const emptyState = document.getElementById('empty-state');
      const actionsBar = document.getElementById('actions-bar');
      const countEl = document.getElementById('fav-count');

      if (favs.length === 0) {
        grid.style.display = 'none';
        actionsBar.style.display = 'none';
        emptyState.style.display = 'block';
        return;
      }

      emptyState.style.display = 'none';
      actionsBar.style.display = 'flex';
      grid.style.display = 'grid';
      countEl.textContent = `${favs.length} ${favs.length === 1 ? 'propiedad guardada' : 'propiedades guardadas'}`;

      grid.innerHTML = '';

      favs.forEach(prop => {
        const card = document.createElement('article');
        card.className = 'fav-card';
        
        let priceLabel = '';
        if (prop.price) {
          const priceStr = formatCOP(prop.price);
          if (prop.operation === 'arrendar') {
            priceLabel = `$${priceStr} COP / mes`;
          } else if (prop.operation === 'dias') {
            priceLabel = `$${priceStr} COP / noche`;
          } else {
            priceLabel = `$${priceStr} COP`;
          }
        }

        const specs = [];
        if (prop.city) specs.push(prop.city);
        if (prop.type) specs.push(capitalize(prop.type));
        if (prop.beds) specs.push(`${prop.beds}H`);
        if (prop.baths) specs.push(`${prop.baths}B`);
        if (prop.sqm) specs.push(`${prop.sqm}m²`);

        card.innerHTML = `
          <div class="media">
            <img src="${prop.image || 'https://i.postimg.cc/0yYb8Y6r/placeholder.png'}" alt="${prop.title || 'Propiedad'}" loading="lazy" />
            <button class="remove-btn" data-id="${prop.id}" aria-label="Eliminar de favoritos">×</button>
          </div>
          <div class="meta">
            <h3>${prop.title || 'Propiedad'}</h3>
            ${priceLabel ? `<div class="price">${priceLabel}</div>` : ''}
            ${specs.length ? `<div class="specs">${specs.join(' · ')}</div>` : ''}
          </div>
        `;

        // Click en la tarjeta para ir a detalle
        card.addEventListener('click', (e) => {
          if (e.target.classList.contains('remove-btn')) return;
          window.location.href = `detalle-propiedad.html?id=${encodeURIComponent(prop.id)}`;
        });

        // Botón eliminar
        const removeBtn = card.querySelector('.remove-btn');
        removeBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          if (confirm('¿Eliminar de favoritos?')) {
            // Remover del localStorage
            try {
              let currentFavs = JSON.parse(localStorage.getItem('altorra:favoritos') || '[]');
              currentFavs = currentFavs.filter(f => f.id !== prop.id);
              localStorage.setItem('altorra:favoritos', JSON.stringify(currentFavs));
              
              // Disparar evento para actualizar badge
              document.dispatchEvent(new CustomEvent('altorra:fav-update', { 
                detail: { count: currentFavs.length } 
              }));
              
              renderFavorites();
            } catch (err) {
              console.error('Error al eliminar favorito:', err);
            }
          }
        });

        grid.appendChild(card);
      });
    }

    // Limpiar todos los favoritos
    document.getElementById('btn-clear-all').addEventListener('click', () => {
      if (confirm('¿Estás seguro de eliminar todos los favoritos?')) {
        try {
          localStorage.removeItem('altorra:favoritos');
          document.dispatchEvent(new CustomEvent('altorra:fav-update', { 
            detail: { count: 0 } 
          }));
          renderFavorites();
        } catch (err) {
          console.error('Error al limpiar favoritos:', err);
        }
      }
    });

    // Render inicial cuando el DOM esté listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', renderFavorites);
    } else {
      renderFavorites();
    }

    // Re-renderizar si se actualiza desde otra pestaña
    window.addEventListener('storage', (e) => {
      if (e.key === 'altorra:favoritos') {
        renderFavorites();
      }
    });
  </script>
</body>

</html>


